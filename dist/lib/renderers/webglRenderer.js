"use strict";

require("core-js/modules/es6.object.define-property");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.WebGLRenderer = void 0;

require("core-js/modules/es7.symbol.async-iterator");

require("core-js/modules/es6.symbol");

require("core-js/modules/es6.object.create");

require("core-js/modules/es6.object.set-prototype-of");

require("core-js/modules/es6.typed.float32-array");

require("core-js/modules/web.dom.iterable");

require("core-js/modules/es6.array.for-each");

var _canvasBaseRenderer = require("./canvasBaseRenderer");

var _browserNotSupportError = require("../../browserNotSupportError");

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

/**
 * WebGL 渲染器类
 */
var WebGLRenderer = function (_CanvasBaseRenderer) {
  _inherits(WebGLRenderer, _CanvasBaseRenderer);

  /**
   * 实例化一个 WebGL 渲染器类
   * @param {object} element - Element 元素
   * @param {openBSE~Options} options - 全局选项
   * @param {object} elementSize - 元素大小
   * @param {Event} eventTrigger - 事件引发方法
   * @throws {openBSE.BrowserNotSupportError} 浏览器不支持特定渲染模式时引发错误
   */
  function WebGLRenderer(element, options, elementSize, eventTrigger) {
    var _this;

    _classCallCheck(this, WebGLRenderer);

    supportCheck();
    _this = _possibleConstructorReturn(this, _getPrototypeOf(WebGLRenderer).call(this, element, options, elementSize, eventTrigger));
    /**
     * 屏幕上的弹幕
     * @private @type {LinkedList}
     */

    var _bulletScreensOnScreen = _this.getBulletScreensOnScreen();
    /**
     * WebGL 上下文对象
     * @private @type {object}
     */


    var _webglContext;

    var _positionAttributeLocation;

    var _resolutionUniformLocation;
    /**
     * Canvas 元素
     * @private @type {object}
     */


    var _canvas = _this.getCanvas();

    init();
    var _cleanScreen = _this.cleanScreen;
    /**
     * 清除屏幕内容
     * @override
     */

    _this.cleanScreen = function () {
      _cleanScreen();

      _webglContext.clear(_webglContext.COLOR_BUFFER_BIT);
    };
    /**
     * 绘制函数
     * @override
     */


    _this.draw = function () {
      var _this2 = this;

      var devicePixelRatio = this.getDevicePixelRatio();

      _webglContext.clear(_webglContext.COLOR_BUFFER_BIT);

      _bulletScreensOnScreen.forEach(function (bulletScreenOnScreen) {
        if (_this2.checkWhetherHide(bulletScreenOnScreen)) return;
        var x1 = (bulletScreenOnScreen.x - 4) * devicePixelRatio;
        var x2 = x1 + (bulletScreenOnScreen.width + 8) * devicePixelRatio;
        var y1 = (bulletScreenOnScreen.actualY - 4) * devicePixelRatio;
        var y2 = y1 + (bulletScreenOnScreen.height + 8) * devicePixelRatio;

        _webglContext.bindTexture(_webglContext.TEXTURE_2D, bulletScreenOnScreen.texture2D);

        var positionBuffer = _webglContext.createBuffer();

        _webglContext.bindBuffer(_webglContext.ARRAY_BUFFER, positionBuffer);

        _webglContext.enableVertexAttribArray(_positionAttributeLocation);

        _webglContext.vertexAttribPointer(_positionAttributeLocation, 2, _webglContext.FLOAT, false, 0, 0);

        _webglContext.bufferData(_webglContext.ARRAY_BUFFER, new Float32Array([x1, y1, x2, y1, x1, y2, x1, y2, x2, y1, x2, y2]), _webglContext.STATIC_DRAW);

        _webglContext.drawArrays(_webglContext.TRIANGLES, 0, 6);
      }, true);
    };

    var _creatAndgetWidth = _this.creatAndgetWidth;
    /**
     * 创建弹幕元素
     * @override
     * @param {object} bulletScreenOnScreen - 屏幕弹幕对象
     */

    _this.creatAndgetWidth = function (bulletScreenOnScreen) {
      _creatAndgetWidth(bulletScreenOnScreen);

      var texture = _webglContext.createTexture();

      _webglContext.bindTexture(_webglContext.TEXTURE_2D, texture);

      _webglContext.texParameteri(_webglContext.TEXTURE_2D, _webglContext.TEXTURE_MIN_FILTER, _webglContext.NEAREST);

      _webglContext.texParameteri(_webglContext.TEXTURE_2D, _webglContext.TEXTURE_MAG_FILTER, _webglContext.NEAREST);

      _webglContext.texParameteri(_webglContext.TEXTURE_2D, _webglContext.TEXTURE_WRAP_S, _webglContext.CLAMP_TO_EDGE);

      _webglContext.texParameteri(_webglContext.TEXTURE_2D, _webglContext.TEXTURE_WRAP_T, _webglContext.CLAMP_TO_EDGE);

      _webglContext.texImage2D(_webglContext.TEXTURE_2D, 0, _webglContext.RGBA, _webglContext.RGBA, _webglContext.UNSIGNED_BYTE, bulletScreenOnScreen.hideCanvas);

      bulletScreenOnScreen.texture2D = texture;
    };

    var _setSize = _this.setSize;
    /**
     * 设置尺寸
     * @override
     */

    _this.setSize = function () {
      _setSize();

      _webglContext.viewport(0, 0, _canvas.width, _canvas.height);

      _webglContext.uniform2f(_resolutionUniformLocation, _canvas.width, _canvas.height);
    };
    /**
     * 初始化
     */


    function init() {
      var createShader = function createShader(gl, type, source) {
        var shader = gl.createShader(type);
        gl.shaderSource(shader, source);
        gl.compileShader(shader);
        var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);

        if (success) {
          return shader;
        }

        gl.deleteShader(shader);
      };

      var createProgram = function createProgram(gl, vertexShader, fragmentShader) {
        var program = gl.createProgram();
        gl.attachShader(program, vertexShader);
        gl.attachShader(program, fragmentShader);
        gl.linkProgram(program);
        var success = gl.getProgramParameter(program, gl.LINK_STATUS);

        if (success) {
          return program;
        }

        gl.deleteProgram(program);
      };

      var vertexShaderSource = 'attribute vec2 a_position;';
      vertexShaderSource += 'attribute vec2 a_texcoord;';
      vertexShaderSource += 'uniform vec2 u_resolution;';
      vertexShaderSource += 'varying vec2 v_texcoord;';
      vertexShaderSource += 'void main() {';
      vertexShaderSource += 'vec2 zeroToOne = a_position / u_resolution;';
      vertexShaderSource += 'vec2 zeroToTwo = zeroToOne * 2.0;';
      vertexShaderSource += 'vec2 clipSpace = zeroToTwo - 1.0;';
      vertexShaderSource += 'gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);';
      vertexShaderSource += 'v_texcoord = a_texcoord;';
      vertexShaderSource += '}';
      var fragmentShaderSource = 'precision mediump float;';
      fragmentShaderSource += 'varying vec2 v_texcoord;';
      fragmentShaderSource += 'uniform sampler2D u_texture;';
      fragmentShaderSource += 'void main() {';
      fragmentShaderSource += 'gl_FragColor = texture2D(u_texture, v_texcoord);';
      fragmentShaderSource += '}';
      _webglContext = _canvas.getContext('webgl');

      _webglContext.enable(_webglContext.BLEND);

      _webglContext.clearColor(0, 0, 0, 0);

      _webglContext.blendFunc(_webglContext.SRC_ALPHA, _webglContext.ONE_MINUS_SRC_ALPHA);

      var vertexShader = createShader(_webglContext, _webglContext.VERTEX_SHADER, vertexShaderSource);
      var fragmentShader = createShader(_webglContext, _webglContext.FRAGMENT_SHADER, fragmentShaderSource);
      var program = createProgram(_webglContext, vertexShader, fragmentShader);

      _webglContext.useProgram(program);

      _positionAttributeLocation = _webglContext.getAttribLocation(program, 'a_position');

      var texcoordAttributeLocation = _webglContext.getAttribLocation(program, 'a_texcoord');

      _resolutionUniformLocation = _webglContext.getUniformLocation(program, 'u_resolution');

      _webglContext.viewport(0, 0, _canvas.width, _canvas.height);

      _webglContext.uniform2f(_resolutionUniformLocation, _canvas.width, _canvas.height);

      var texcoordBuffer = _webglContext.createBuffer();

      _webglContext.bindBuffer(_webglContext.ARRAY_BUFFER, texcoordBuffer);

      _webglContext.enableVertexAttribArray(texcoordAttributeLocation);

      _webglContext.vertexAttribPointer(texcoordAttributeLocation, 2, _webglContext.FLOAT, false, 0, 0);

      _webglContext.bufferData(_webglContext.ARRAY_BUFFER, new Float32Array([0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1]), _webglContext.STATIC_DRAW);
    }
    /**
     * 浏览器支持检测
     * @throws {openBSE.BrowserNotSupportError} 浏览器不支持特定渲染模式时引发错误
     */


    function supportCheck() {
      var canvas = document.createElement('canvas');
      if (typeof canvas.getContext != 'function') throw new _browserNotSupportError.BrowserNotSupportError('Canvas');
      var context = canvas.getContext('2d');
      if (context === null) throw new _browserNotSupportError.BrowserNotSupportError('Canvas 2D');
      if (typeof context.fillText != 'function') throw new _browserNotSupportError.BrowserNotSupportError('Canvas 2D fillText Function');
      canvas = document.createElement('canvas');
      context = canvas.getContext('webgl');
      if (context === null) throw new _browserNotSupportError.BrowserNotSupportError('WebGL');
    }

    return _this;
  }

  return WebGLRenderer;
}(_canvasBaseRenderer.CanvasBaseRenderer);

exports.WebGLRenderer = WebGLRenderer;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW5kZXJlcnMvd2ViZ2xSZW5kZXJlci5qcyJdLCJuYW1lcyI6WyJXZWJHTFJlbmRlcmVyIiwiZWxlbWVudCIsIm9wdGlvbnMiLCJlbGVtZW50U2l6ZSIsImV2ZW50VHJpZ2dlciIsInN1cHBvcnRDaGVjayIsIl9idWxsZXRTY3JlZW5zT25TY3JlZW4iLCJnZXRCdWxsZXRTY3JlZW5zT25TY3JlZW4iLCJfd2ViZ2xDb250ZXh0IiwiX3Bvc2l0aW9uQXR0cmlidXRlTG9jYXRpb24iLCJfcmVzb2x1dGlvblVuaWZvcm1Mb2NhdGlvbiIsIl9jYW52YXMiLCJnZXRDYW52YXMiLCJpbml0IiwiX2NsZWFuU2NyZWVuIiwiY2xlYW5TY3JlZW4iLCJjbGVhciIsIkNPTE9SX0JVRkZFUl9CSVQiLCJkcmF3IiwiZGV2aWNlUGl4ZWxSYXRpbyIsImdldERldmljZVBpeGVsUmF0aW8iLCJmb3JFYWNoIiwiYnVsbGV0U2NyZWVuT25TY3JlZW4iLCJjaGVja1doZXRoZXJIaWRlIiwieDEiLCJ4IiwieDIiLCJ3aWR0aCIsInkxIiwiYWN0dWFsWSIsInkyIiwiaGVpZ2h0IiwiYmluZFRleHR1cmUiLCJURVhUVVJFXzJEIiwidGV4dHVyZTJEIiwicG9zaXRpb25CdWZmZXIiLCJjcmVhdGVCdWZmZXIiLCJiaW5kQnVmZmVyIiwiQVJSQVlfQlVGRkVSIiwiZW5hYmxlVmVydGV4QXR0cmliQXJyYXkiLCJ2ZXJ0ZXhBdHRyaWJQb2ludGVyIiwiRkxPQVQiLCJidWZmZXJEYXRhIiwiRmxvYXQzMkFycmF5IiwiU1RBVElDX0RSQVciLCJkcmF3QXJyYXlzIiwiVFJJQU5HTEVTIiwiX2NyZWF0QW5kZ2V0V2lkdGgiLCJjcmVhdEFuZGdldFdpZHRoIiwidGV4dHVyZSIsImNyZWF0ZVRleHR1cmUiLCJ0ZXhQYXJhbWV0ZXJpIiwiVEVYVFVSRV9NSU5fRklMVEVSIiwiTkVBUkVTVCIsIlRFWFRVUkVfTUFHX0ZJTFRFUiIsIlRFWFRVUkVfV1JBUF9TIiwiQ0xBTVBfVE9fRURHRSIsIlRFWFRVUkVfV1JBUF9UIiwidGV4SW1hZ2UyRCIsIlJHQkEiLCJVTlNJR05FRF9CWVRFIiwiaGlkZUNhbnZhcyIsIl9zZXRTaXplIiwic2V0U2l6ZSIsInZpZXdwb3J0IiwidW5pZm9ybTJmIiwiY3JlYXRlU2hhZGVyIiwiZ2wiLCJ0eXBlIiwic291cmNlIiwic2hhZGVyIiwic2hhZGVyU291cmNlIiwiY29tcGlsZVNoYWRlciIsInN1Y2Nlc3MiLCJnZXRTaGFkZXJQYXJhbWV0ZXIiLCJDT01QSUxFX1NUQVRVUyIsImRlbGV0ZVNoYWRlciIsImNyZWF0ZVByb2dyYW0iLCJ2ZXJ0ZXhTaGFkZXIiLCJmcmFnbWVudFNoYWRlciIsInByb2dyYW0iLCJhdHRhY2hTaGFkZXIiLCJsaW5rUHJvZ3JhbSIsImdldFByb2dyYW1QYXJhbWV0ZXIiLCJMSU5LX1NUQVRVUyIsImRlbGV0ZVByb2dyYW0iLCJ2ZXJ0ZXhTaGFkZXJTb3VyY2UiLCJmcmFnbWVudFNoYWRlclNvdXJjZSIsImdldENvbnRleHQiLCJlbmFibGUiLCJCTEVORCIsImNsZWFyQ29sb3IiLCJibGVuZEZ1bmMiLCJTUkNfQUxQSEEiLCJPTkVfTUlOVVNfU1JDX0FMUEhBIiwiVkVSVEVYX1NIQURFUiIsIkZSQUdNRU5UX1NIQURFUiIsInVzZVByb2dyYW0iLCJnZXRBdHRyaWJMb2NhdGlvbiIsInRleGNvb3JkQXR0cmlidXRlTG9jYXRpb24iLCJnZXRVbmlmb3JtTG9jYXRpb24iLCJ0ZXhjb29yZEJ1ZmZlciIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIkJyb3dzZXJOb3RTdXBwb3J0RXJyb3IiLCJjb250ZXh0IiwiZmlsbFRleHQiLCJDYW52YXNCYXNlUmVuZGVyZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQTs7O0lBR01BLGE7OztBQUNGOzs7Ozs7OztBQVFBLHlCQUFZQyxPQUFaLEVBQXFCQyxPQUFyQixFQUE4QkMsV0FBOUIsRUFBMkNDLFlBQTND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QyxhQUFULENBQXVCLFFBQXZCLENBQVQ7QUFDQUUsTUFBQUEsT0FBTyxHQUFHSixNQUFNLENBQUNkLFVBQVAsQ0FBa0IsT0FBbEIsQ0FBVjtBQUNBLFVBQUlrQixPQUFPLEtBQUssSUFBaEIsRUFBc0IsTUFBTSxJQUFJRCw4Q0FBSixDQUEyQixPQUEzQixDQUFOO0FBQ3pCOztBQTdNb0Q7QUE4TXhEOzs7RUF2TnVCRyxzQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENhbnZhc0Jhc2VSZW5kZXJlciB9IGZyb20gJy4vY2FudmFzQmFzZVJlbmRlcmVyJ1xyXG5pbXBvcnQgeyBCcm93c2VyTm90U3VwcG9ydEVycm9yIH0gZnJvbSAnLi4vLi4vYnJvd3Nlck5vdFN1cHBvcnRFcnJvcidcclxuXHJcbi8qKlxyXG4gKiBXZWJHTCDmuLLmn5PlmajnsbtcclxuICovXHJcbmNsYXNzIFdlYkdMUmVuZGVyZXIgZXh0ZW5kcyBDYW52YXNCYXNlUmVuZGVyZXIge1xyXG4gICAgLyoqXHJcbiAgICAgKiDlrp7kvovljJbkuIDkuKogV2ViR0wg5riy5p+T5Zmo57G7XHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gZWxlbWVudCAtIEVsZW1lbnQg5YWD57SgXHJcbiAgICAgKiBAcGFyYW0ge29wZW5CU0V+T3B0aW9uc30gb3B0aW9ucyAtIOWFqOWxgOmAiemhuVxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGVsZW1lbnRTaXplIC0g5YWD57Sg5aSn5bCPXHJcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudFRyaWdnZXIgLSDkuovku7blvJXlj5Hmlrnms5VcclxuICAgICAqIEB0aHJvd3Mge29wZW5CU0UuQnJvd3Nlck5vdFN1cHBvcnRFcnJvcn0g5rWP6KeI5Zmo5LiN5pSv5oyB54m55a6a5riy5p+T5qih5byP5pe25byV5Y+R6ZSZ6K+vXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQsIG9wdGlvbnMsIGVsZW1lbnRTaXplLCBldmVudFRyaWdnZXIpIHtcclxuICAgICAgICBzdXBwb3J0Q2hlY2soKTsgLy/mtY/op4jlmajmlK/mjIHmo4DmtYtcclxuICAgICAgICBzdXBlcihlbGVtZW50LCBvcHRpb25zLCBlbGVtZW50U2l6ZSwgZXZlbnRUcmlnZ2VyKTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDlsY/luZXkuIrnmoTlvLnluZVcclxuICAgICAgICAgKiBAcHJpdmF0ZSBAdHlwZSB7TGlua2VkTGlzdH1cclxuICAgICAgICAgKi9cclxuICAgICAgICBsZXQgX2J1bGxldFNjcmVlbnNPblNjcmVlbiA9IHRoaXMuZ2V0QnVsbGV0U2NyZWVuc09uU2NyZWVuKCk7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogV2ViR0wg5LiK5LiL5paH5a+56LGhXHJcbiAgICAgICAgICogQHByaXZhdGUgQHR5cGUge29iamVjdH1cclxuICAgICAgICAgKi9cclxuICAgICAgICBsZXQgX3dlYmdsQ29udGV4dDtcclxuICAgICAgICBsZXQgX3Bvc2l0aW9uQXR0cmlidXRlTG9jYXRpb247XHJcbiAgICAgICAgbGV0IF9yZXNvbHV0aW9uVW5pZm9ybUxvY2F0aW9uO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENhbnZhcyDlhYPntKBcclxuICAgICAgICAgKiBAcHJpdmF0ZSBAdHlwZSB7b2JqZWN0fVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGxldCBfY2FudmFzID0gdGhpcy5nZXRDYW52YXMoKTtcclxuICAgICAgICBpbml0KCk7XHJcblxyXG4gICAgICAgIGxldCBfY2xlYW5TY3JlZW4gPSB0aGlzLmNsZWFuU2NyZWVuO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOa4hemZpOWxj+W5leWGheWuuVxyXG4gICAgICAgICAqIEBvdmVycmlkZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuY2xlYW5TY3JlZW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF9jbGVhblNjcmVlbigpO1xyXG4gICAgICAgICAgICBfd2ViZ2xDb250ZXh0LmNsZWFyKF93ZWJnbENvbnRleHQuQ09MT1JfQlVGRkVSX0JJVCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDnu5jliLblh73mlbBcclxuICAgICAgICAgKiBAb3ZlcnJpZGVcclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLmRyYXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGxldCBkZXZpY2VQaXhlbFJhdGlvID0gdGhpcy5nZXREZXZpY2VQaXhlbFJhdGlvKCk7XHJcbiAgICAgICAgICAgIC8vIOa4heepuueUu+W4g1xyXG4gICAgICAgICAgICBfd2ViZ2xDb250ZXh0LmNsZWFyKF93ZWJnbENvbnRleHQuQ09MT1JfQlVGRkVSX0JJVCk7XHJcbiAgICAgICAgICAgIF9idWxsZXRTY3JlZW5zT25TY3JlZW4uZm9yRWFjaCgoYnVsbGV0U2NyZWVuT25TY3JlZW4pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrV2hldGhlckhpZGUoYnVsbGV0U2NyZWVuT25TY3JlZW4pKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAvLyDlm5vkuKrpobbngrnlnZDmoIdcclxuICAgICAgICAgICAgICAgIGxldCB4MSA9IChidWxsZXRTY3JlZW5PblNjcmVlbi54IC0gNCkgKiBkZXZpY2VQaXhlbFJhdGlvO1xyXG4gICAgICAgICAgICAgICAgbGV0IHgyID0geDEgKyAoYnVsbGV0U2NyZWVuT25TY3JlZW4ud2lkdGggKyA4KSAqIGRldmljZVBpeGVsUmF0aW87XHJcbiAgICAgICAgICAgICAgICBsZXQgeTEgPSAoYnVsbGV0U2NyZWVuT25TY3JlZW4uYWN0dWFsWSAtIDQpICogZGV2aWNlUGl4ZWxSYXRpbztcclxuICAgICAgICAgICAgICAgIGxldCB5MiA9IHkxICsgKGJ1bGxldFNjcmVlbk9uU2NyZWVuLmhlaWdodCArIDgpICogZGV2aWNlUGl4ZWxSYXRpbztcclxuICAgICAgICAgICAgICAgIC8v57uR5a6a57q555CGXHJcbiAgICAgICAgICAgICAgICBfd2ViZ2xDb250ZXh0LmJpbmRUZXh0dXJlKF93ZWJnbENvbnRleHQuVEVYVFVSRV8yRCwgYnVsbGV0U2NyZWVuT25TY3JlZW4udGV4dHVyZTJEKTtcclxuICAgICAgICAgICAgICAgIC8v57uR5a6a6IyD5Zu0XHJcbiAgICAgICAgICAgICAgICBsZXQgcG9zaXRpb25CdWZmZXIgPSBfd2ViZ2xDb250ZXh0LmNyZWF0ZUJ1ZmZlcigpO1xyXG4gICAgICAgICAgICAgICAgLy8g5bCG57uR5a6a54K557uR5a6a5Yiw57yT5Yay5pWw5o2u77yIcG9zaXRpb25CdWZmZXLvvIlcclxuICAgICAgICAgICAgICAgIF93ZWJnbENvbnRleHQuYmluZEJ1ZmZlcihfd2ViZ2xDb250ZXh0LkFSUkFZX0JVRkZFUiwgcG9zaXRpb25CdWZmZXIpO1xyXG4gICAgICAgICAgICAgICAgX3dlYmdsQ29udGV4dC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShfcG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAvLyDlkYror4nlsZ7mgKfmgI7kuYjku45wb3NpdGlvbkJ1ZmZlcuS4reivu+WPluaVsOaNriAoQVJSQVlfQlVGRkVSKVxyXG4gICAgICAgICAgICAgICAgX3dlYmdsQ29udGV4dC52ZXJ0ZXhBdHRyaWJQb2ludGVyKF9wb3NpdGlvbkF0dHJpYnV0ZUxvY2F0aW9uLCAyLCAvL3NpemUg5q+P5qyh6L+t5Luj6L+Q6KGM5o+Q5Y+W5Lik5Liq5Y2V5L2N5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAgICAgX3dlYmdsQ29udGV4dC5GTE9BVCwgLy90eXBlIOavj+S4quWNleS9jeeahOaVsOaNruexu+Wei+aYrzMy5L2N5rWu54K55Z6LXHJcbiAgICAgICAgICAgICAgICAgICAgZmFsc2UsIC8vbm9ybWFsaXplIOS4jemcgOimgeW9kuS4gOWMluaVsOaNrlxyXG4gICAgICAgICAgICAgICAgICAgIDAsIC8vc3RyaWRlIDAgPSDnp7vliqjljZXkvY3mlbDph48gKiDmr4/kuKrljZXkvY3ljaDnlKjlhoXlrZjvvIhzaXplb2YodHlwZSnvvIlcclxuICAgICAgICAgICAgICAgICAgICAvLyDmr4/mrKHov63ku6Pov5DooYzov5DliqjlpJrlsJHlhoXlrZjliLDkuIvkuIDkuKrmlbDmja7lvIDlp4vngrlcclxuICAgICAgICAgICAgICAgICAgICAwIC8vb2Zmc2V0IOS7jue8k+WGsui1t+Wni+S9jee9ruW8gOWni+ivu+WPllxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIF93ZWJnbENvbnRleHQuYnVmZmVyRGF0YShfd2ViZ2xDb250ZXh0LkFSUkFZX0JVRkZFUiwgbmV3IEZsb2F0MzJBcnJheShbeDEsIHkxLFxyXG4gICAgICAgICAgICAgICAgICAgIHgyLCB5MSxcclxuICAgICAgICAgICAgICAgICAgICB4MSwgeTIsXHJcbiAgICAgICAgICAgICAgICAgICAgeDEsIHkyLFxyXG4gICAgICAgICAgICAgICAgICAgIHgyLCB5MSxcclxuICAgICAgICAgICAgICAgICAgICB4MiwgeTJdKSwgX3dlYmdsQ29udGV4dC5TVEFUSUNfRFJBVyk7XHJcbiAgICAgICAgICAgICAgICAvL+e7mOWItlxyXG4gICAgICAgICAgICAgICAgX3dlYmdsQ29udGV4dC5kcmF3QXJyYXlzKF93ZWJnbENvbnRleHQuVFJJQU5HTEVTLCAvL3ByaW1pdGl2ZVR5cGVcclxuICAgICAgICAgICAgICAgICAgICAwLCAvL29mZnNldFxyXG4gICAgICAgICAgICAgICAgICAgIDYgLy9jb3VudFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgX2NyZWF0QW5kZ2V0V2lkdGggPSB0aGlzLmNyZWF0QW5kZ2V0V2lkdGg7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog5Yib5bu65by55bmV5YWD57SgXHJcbiAgICAgICAgICogQG92ZXJyaWRlXHJcbiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IGJ1bGxldFNjcmVlbk9uU2NyZWVuIC0g5bGP5bmV5by55bmV5a+56LGhXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5jcmVhdEFuZGdldFdpZHRoID0gZnVuY3Rpb24gKGJ1bGxldFNjcmVlbk9uU2NyZWVuKSB7XHJcbiAgICAgICAgICAgIF9jcmVhdEFuZGdldFdpZHRoKGJ1bGxldFNjcmVlbk9uU2NyZWVuKTtcclxuICAgICAgICAgICAgbGV0IHRleHR1cmUgPSBfd2ViZ2xDb250ZXh0LmNyZWF0ZVRleHR1cmUoKTtcclxuICAgICAgICAgICAgX3dlYmdsQ29udGV4dC5iaW5kVGV4dHVyZShfd2ViZ2xDb250ZXh0LlRFWFRVUkVfMkQsIHRleHR1cmUpO1xyXG4gICAgICAgICAgICAvLyDorr7nva7lj4LmlbBcclxuICAgICAgICAgICAgX3dlYmdsQ29udGV4dC50ZXhQYXJhbWV0ZXJpKF93ZWJnbENvbnRleHQuVEVYVFVSRV8yRCwgX3dlYmdsQ29udGV4dC5URVhUVVJFX01JTl9GSUxURVIsIF93ZWJnbENvbnRleHQuTkVBUkVTVCk7XHJcbiAgICAgICAgICAgIF93ZWJnbENvbnRleHQudGV4UGFyYW1ldGVyaShfd2ViZ2xDb250ZXh0LlRFWFRVUkVfMkQsIF93ZWJnbENvbnRleHQuVEVYVFVSRV9NQUdfRklMVEVSLCBfd2ViZ2xDb250ZXh0Lk5FQVJFU1QpO1xyXG4gICAgICAgICAgICBfd2ViZ2xDb250ZXh0LnRleFBhcmFtZXRlcmkoX3dlYmdsQ29udGV4dC5URVhUVVJFXzJELCBfd2ViZ2xDb250ZXh0LlRFWFRVUkVfV1JBUF9TLCBfd2ViZ2xDb250ZXh0LkNMQU1QX1RPX0VER0UpO1xyXG4gICAgICAgICAgICBfd2ViZ2xDb250ZXh0LnRleFBhcmFtZXRlcmkoX3dlYmdsQ29udGV4dC5URVhUVVJFXzJELCBfd2ViZ2xDb250ZXh0LlRFWFRVUkVfV1JBUF9ULCBfd2ViZ2xDb250ZXh0LkNMQU1QX1RPX0VER0UpO1xyXG4gICAgICAgICAgICBfd2ViZ2xDb250ZXh0LnRleEltYWdlMkQoX3dlYmdsQ29udGV4dC5URVhUVVJFXzJELCAwLCBfd2ViZ2xDb250ZXh0LlJHQkEsIF93ZWJnbENvbnRleHQuUkdCQSwgX3dlYmdsQ29udGV4dC5VTlNJR05FRF9CWVRFLCBidWxsZXRTY3JlZW5PblNjcmVlbi5oaWRlQ2FudmFzKTtcclxuICAgICAgICAgICAgYnVsbGV0U2NyZWVuT25TY3JlZW4udGV4dHVyZTJEID0gdGV4dHVyZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBfc2V0U2l6ZSA9IHRoaXMuc2V0U2l6ZTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDorr7nva7lsLrlr7hcclxuICAgICAgICAgKiBAb3ZlcnJpZGVcclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnNldFNpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF9zZXRTaXplKCk7XHJcbiAgICAgICAgICAgIF93ZWJnbENvbnRleHQudmlld3BvcnQoMCwgMCwgX2NhbnZhcy53aWR0aCwgX2NhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgICAgICBfd2ViZ2xDb250ZXh0LnVuaWZvcm0yZihfcmVzb2x1dGlvblVuaWZvcm1Mb2NhdGlvbiwgX2NhbnZhcy53aWR0aCwgX2NhbnZhcy5oZWlnaHQpOyAvLyDorr7nva7lhajlsYDlj5jph48g5YiG6L6o546HXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDliJ3lp4vljJZcclxuICAgICAgICAgKi9cclxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgICAgICAgICAvLyDliJvlu7rnnYDoibLlmajmlrnms5XvvIzovpPlhaXlj4LmlbDvvJrmuLLmn5PkuIrkuIvmlofvvIznnYDoibLlmajnsbvlnovvvIzmlbDmja7mupBcclxuICAgICAgICAgICAgbGV0IGNyZWF0ZVNoYWRlciA9IGZ1bmN0aW9uIChnbCwgdHlwZSwgc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKHR5cGUpOyAvLyDliJvlu7rnnYDoibLlmajlr7nosaFcclxuICAgICAgICAgICAgICAgIGdsLnNoYWRlclNvdXJjZShzaGFkZXIsIHNvdXJjZSk7IC8vIOaPkOS+m+aVsOaNrua6kFxyXG4gICAgICAgICAgICAgICAgZ2wuY29tcGlsZVNoYWRlcihzaGFkZXIpOyAvLyDnvJbor5EgLT4g55Sf5oiQ552A6Imy5ZmoXHJcbiAgICAgICAgICAgICAgICBsZXQgc3VjY2VzcyA9IGdsLmdldFNoYWRlclBhcmFtZXRlcihzaGFkZXIsIGdsLkNPTVBJTEVfU1RBVFVTKTtcclxuICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNoYWRlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGdsLmRlbGV0ZVNoYWRlcihzaGFkZXIpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAvLyDliJvlu7rnnYDoibLnqIvluo/vvIzovpPlhaXlj4LmlbDvvJrmuLLmn5PkuIrkuIvmlofvvIzpobbngrnnnYDoibLlmajvvIzniYfmrrXnnYDoibLlmahcclxuICAgICAgICAgICAgbGV0IGNyZWF0ZVByb2dyYW0gPSBmdW5jdGlvbiAoZ2wsIHZlcnRleFNoYWRlciwgZnJhZ21lbnRTaGFkZXIpIHtcclxuICAgICAgICAgICAgICAgIGxldCBwcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpO1xyXG4gICAgICAgICAgICAgICAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZlcnRleFNoYWRlcik7XHJcbiAgICAgICAgICAgICAgICBnbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgZnJhZ21lbnRTaGFkZXIpO1xyXG4gICAgICAgICAgICAgICAgZ2wubGlua1Byb2dyYW0ocHJvZ3JhbSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3VjY2VzcyA9IGdsLmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZ3JhbSwgZ2wuTElOS19TVEFUVVMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvZ3JhbTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGdsLmRlbGV0ZVByb2dyYW0ocHJvZ3JhbSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8v6aG254K5552A6Imy5Zmo5Luj56CBXHJcbiAgICAgICAgICAgIGxldCB2ZXJ0ZXhTaGFkZXJTb3VyY2UgPSAnYXR0cmlidXRlIHZlYzIgYV9wb3NpdGlvbjsnO1xyXG4gICAgICAgICAgICB2ZXJ0ZXhTaGFkZXJTb3VyY2UgKz0gJ2F0dHJpYnV0ZSB2ZWMyIGFfdGV4Y29vcmQ7JztcclxuICAgICAgICAgICAgdmVydGV4U2hhZGVyU291cmNlICs9ICd1bmlmb3JtIHZlYzIgdV9yZXNvbHV0aW9uOyc7XHJcbiAgICAgICAgICAgIHZlcnRleFNoYWRlclNvdXJjZSArPSAndmFyeWluZyB2ZWMyIHZfdGV4Y29vcmQ7JztcclxuICAgICAgICAgICAgdmVydGV4U2hhZGVyU291cmNlICs9ICd2b2lkIG1haW4oKSB7JztcclxuICAgICAgICAgICAgLy8g5LuO5YOP57Sg5Z2Q5qCH6L2s5o2i5YiwIDAuMCDliLAgMS4wXHJcbiAgICAgICAgICAgIHZlcnRleFNoYWRlclNvdXJjZSArPSAndmVjMiB6ZXJvVG9PbmUgPSBhX3Bvc2l0aW9uIC8gdV9yZXNvbHV0aW9uOyc7XHJcbiAgICAgICAgICAgIC8vIOWGjeaKiiAwLT4xIOi9rOaNoiAwLT4yXHJcbiAgICAgICAgICAgIHZlcnRleFNoYWRlclNvdXJjZSArPSAndmVjMiB6ZXJvVG9Ud28gPSB6ZXJvVG9PbmUgKiAyLjA7JztcclxuICAgICAgICAgICAgLy8g5oqKIDAtPjIg6L2s5o2i5YiwIC0xLT4rMSAo6KOB5Ymq56m66Ze0KVxyXG4gICAgICAgICAgICB2ZXJ0ZXhTaGFkZXJTb3VyY2UgKz0gJ3ZlYzIgY2xpcFNwYWNlID0gemVyb1RvVHdvIC0gMS4wOyc7XHJcbiAgICAgICAgICAgIHZlcnRleFNoYWRlclNvdXJjZSArPSAnZ2xfUG9zaXRpb24gPSB2ZWM0KGNsaXBTcGFjZSAqIHZlYzIoMSwgLTEpLCAwLCAxKTsnO1xyXG4gICAgICAgICAgICAvLyDkvKDpgJLnurnnkIblnZDmoIfliLDniYfmlq3nnYDoibLlmahcclxuICAgICAgICAgICAgdmVydGV4U2hhZGVyU291cmNlICs9ICd2X3RleGNvb3JkID0gYV90ZXhjb29yZDsnO1xyXG4gICAgICAgICAgICB2ZXJ0ZXhTaGFkZXJTb3VyY2UgKz0gJ30nO1xyXG4gICAgICAgICAgICAvL+eJh+auteedgOiJsuWZqOS7o+eggVxyXG4gICAgICAgICAgICBsZXQgZnJhZ21lbnRTaGFkZXJTb3VyY2UgPSAncHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7JztcclxuICAgICAgICAgICAgLy8g5LuO6aG254K5552A6Imy5Zmo5Lit5Lyg5YWl55qE5YC8XHJcbiAgICAgICAgICAgIGZyYWdtZW50U2hhZGVyU291cmNlICs9ICd2YXJ5aW5nIHZlYzIgdl90ZXhjb29yZDsnO1xyXG4gICAgICAgICAgICAvLyDnurnnkIZcclxuICAgICAgICAgICAgZnJhZ21lbnRTaGFkZXJTb3VyY2UgKz0gJ3VuaWZvcm0gc2FtcGxlcjJEIHVfdGV4dHVyZTsnO1xyXG4gICAgICAgICAgICBmcmFnbWVudFNoYWRlclNvdXJjZSArPSAndm9pZCBtYWluKCkgeyc7XHJcbiAgICAgICAgICAgIGZyYWdtZW50U2hhZGVyU291cmNlICs9ICdnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQodV90ZXh0dXJlLCB2X3RleGNvb3JkKTsnO1xyXG4gICAgICAgICAgICBmcmFnbWVudFNoYWRlclNvdXJjZSArPSAnfSc7XHJcbiAgICAgICAgICAgIF93ZWJnbENvbnRleHQgPSBfY2FudmFzLmdldENvbnRleHQoJ3dlYmdsJyk7XHJcbiAgICAgICAgICAgIF93ZWJnbENvbnRleHQuZW5hYmxlKF93ZWJnbENvbnRleHQuQkxFTkQpOyAvL+W8gOWQr+a3t+WQiOWKn+iDvVxyXG4gICAgICAgICAgICBfd2ViZ2xDb250ZXh0LmNsZWFyQ29sb3IoMCwgMCwgMCwgMCk7IC8v6K6+572u5riF6Zmk6aKc6ImyXHJcbiAgICAgICAgICAgIF93ZWJnbENvbnRleHQuYmxlbmRGdW5jKF93ZWJnbENvbnRleHQuU1JDX0FMUEhBLCBfd2ViZ2xDb250ZXh0Lk9ORV9NSU5VU19TUkNfQUxQSEEpO1xyXG4gICAgICAgICAgICBsZXQgdmVydGV4U2hhZGVyID0gY3JlYXRlU2hhZGVyKF93ZWJnbENvbnRleHQsIF93ZWJnbENvbnRleHQuVkVSVEVYX1NIQURFUiwgdmVydGV4U2hhZGVyU291cmNlKTsgLy/liJvlu7rpobbngrnnnYDoibLlmahcclxuICAgICAgICAgICAgbGV0IGZyYWdtZW50U2hhZGVyID0gY3JlYXRlU2hhZGVyKF93ZWJnbENvbnRleHQsIF93ZWJnbENvbnRleHQuRlJBR01FTlRfU0hBREVSLCBmcmFnbWVudFNoYWRlclNvdXJjZSk7IC8v5Yib5bu654mH5q61552A6Imy5ZmoXHJcbiAgICAgICAgICAgIGxldCBwcm9ncmFtID0gY3JlYXRlUHJvZ3JhbShfd2ViZ2xDb250ZXh0LCB2ZXJ0ZXhTaGFkZXIsIGZyYWdtZW50U2hhZGVyKTsgLy/liJvlu7rnnYDoibLnqIvluo9cclxuICAgICAgICAgICAgX3dlYmdsQ29udGV4dC51c2VQcm9ncmFtKHByb2dyYW0pO1xyXG4gICAgICAgICAgICBfcG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiA9IF93ZWJnbENvbnRleHQuZ2V0QXR0cmliTG9jYXRpb24ocHJvZ3JhbSwgJ2FfcG9zaXRpb24nKTtcclxuICAgICAgICAgICAgbGV0IHRleGNvb3JkQXR0cmlidXRlTG9jYXRpb24gPSBfd2ViZ2xDb250ZXh0LmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sICdhX3RleGNvb3JkJyk7XHJcbiAgICAgICAgICAgIF9yZXNvbHV0aW9uVW5pZm9ybUxvY2F0aW9uID0gX3dlYmdsQ29udGV4dC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgJ3VfcmVzb2x1dGlvbicpO1xyXG4gICAgICAgICAgICBfd2ViZ2xDb250ZXh0LnZpZXdwb3J0KDAsIDAsIF9jYW52YXMud2lkdGgsIF9jYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICAgICAgX3dlYmdsQ29udGV4dC51bmlmb3JtMmYoX3Jlc29sdXRpb25Vbmlmb3JtTG9jYXRpb24sIF9jYW52YXMud2lkdGgsIF9jYW52YXMuaGVpZ2h0KTsgLy8g6K6+572u5YWo5bGA5Y+Y6YePIOWIhui+qOeOh1xyXG4gICAgICAgICAgICAvL+e7keWumuiMg+WbtFxyXG4gICAgICAgICAgICBsZXQgdGV4Y29vcmRCdWZmZXIgPSBfd2ViZ2xDb250ZXh0LmNyZWF0ZUJ1ZmZlcigpO1xyXG4gICAgICAgICAgICAvLyDlsIbnu5Hlrprngrnnu5HlrprliLDnvJPlhrLmlbDmja7vvIh0ZXhjb29yZEJ1ZmZlcu+8iVxyXG4gICAgICAgICAgICBfd2ViZ2xDb250ZXh0LmJpbmRCdWZmZXIoX3dlYmdsQ29udGV4dC5BUlJBWV9CVUZGRVIsIHRleGNvb3JkQnVmZmVyKTtcclxuICAgICAgICAgICAgX3dlYmdsQ29udGV4dC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSh0ZXhjb29yZEF0dHJpYnV0ZUxvY2F0aW9uKTtcclxuICAgICAgICAgICAgLy8g5Lul5rWu54K55Z6L5qC85byP5Lyg6YCS57q555CG5Z2Q5qCHXHJcbiAgICAgICAgICAgIF93ZWJnbENvbnRleHQudmVydGV4QXR0cmliUG9pbnRlcih0ZXhjb29yZEF0dHJpYnV0ZUxvY2F0aW9uLCAyLCAvL3NpemUg5q+P5qyh6L+t5Luj6L+Q6KGM5o+Q5Y+W5Lik5Liq5Y2V5L2N5pWw5o2uXHJcbiAgICAgICAgICAgICAgICBfd2ViZ2xDb250ZXh0LkZMT0FULCAvL3R5cGUg5q+P5Liq5Y2V5L2N55qE5pWw5o2u57G75Z6L5pivMzLkvY3mta7ngrnlnotcclxuICAgICAgICAgICAgICAgIGZhbHNlLCAvL25vcm1hbGl6ZSDkuI3pnIDopoHlvZLkuIDljJbmlbDmja4gXHJcbiAgICAgICAgICAgICAgICAwLCAvL3N0cmlkZSAwID0g56e75Yqo5Y2V5L2N5pWw6YePICog5q+P5Liq5Y2V5L2N5Y2g55So5YaF5a2Y77yIc2l6ZW9mKHR5cGUp77yJXHJcbiAgICAgICAgICAgICAgICAvLyDmr4/mrKHov63ku6Pov5DooYzov5DliqjlpJrlsJHlhoXlrZjliLDkuIvkuIDkuKrmlbDmja7lvIDlp4vngrlcclxuICAgICAgICAgICAgICAgIDAgLy9vZmZzZXQg5LuO57yT5Yay6LW35aeL5L2N572u5byA5aeL6K+75Y+WXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIF93ZWJnbENvbnRleHQuYnVmZmVyRGF0YShfd2ViZ2xDb250ZXh0LkFSUkFZX0JVRkZFUiwgbmV3IEZsb2F0MzJBcnJheShbMCwgMCxcclxuICAgICAgICAgICAgICAgIDEsIDAsXHJcbiAgICAgICAgICAgICAgICAwLCAxLFxyXG4gICAgICAgICAgICAgICAgMCwgMSxcclxuICAgICAgICAgICAgICAgIDEsIDAsXHJcbiAgICAgICAgICAgICAgICAxLCAxXSksIF93ZWJnbENvbnRleHQuU1RBVElDX0RSQVcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog5rWP6KeI5Zmo5pSv5oyB5qOA5rWLXHJcbiAgICAgICAgICogQHRocm93cyB7b3BlbkJTRS5Ccm93c2VyTm90U3VwcG9ydEVycm9yfSDmtY/op4jlmajkuI3mlK/mjIHnibnlrprmuLLmn5PmqKHlvI/ml7blvJXlj5HplJnor69cclxuICAgICAgICAgKi9cclxuICAgICAgICBmdW5jdGlvbiBzdXBwb3J0Q2hlY2soKSB7XHJcbiAgICAgICAgICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsgLy9jYW52YXPlr7nosaFcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjYW52YXMuZ2V0Q29udGV4dCAhPSAnZnVuY3Rpb24nKSB0aHJvdyBuZXcgQnJvd3Nlck5vdFN1cHBvcnRFcnJvcignQ2FudmFzJyk7XHJcbiAgICAgICAgICAgIGxldCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgICAgIGlmIChjb250ZXh0ID09PSBudWxsKSB0aHJvdyBuZXcgQnJvd3Nlck5vdFN1cHBvcnRFcnJvcignQ2FudmFzIDJEJyk7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29udGV4dC5maWxsVGV4dCAhPSAnZnVuY3Rpb24nKSB0aHJvdyBuZXcgQnJvd3Nlck5vdFN1cHBvcnRFcnJvcignQ2FudmFzIDJEIGZpbGxUZXh0IEZ1bmN0aW9uJyk7XHJcbiAgICAgICAgICAgIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOyAvL2NhbnZhc+WvueixoVxyXG4gICAgICAgICAgICBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJ3dlYmdsJyk7XHJcbiAgICAgICAgICAgIGlmIChjb250ZXh0ID09PSBudWxsKSB0aHJvdyBuZXcgQnJvd3Nlck5vdFN1cHBvcnRFcnJvcignV2ViR0wnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFdlYkdMUmVuZGVyZXIgfTsiXSwiZmlsZSI6ImxpYi9yZW5kZXJlcnMvd2ViZ2xSZW5kZXJlci5qcyJ9
