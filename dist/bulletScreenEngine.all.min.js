/*!
MIT License

Copyright (c) 2018-2019 Scott Xu

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

Home: https://iamscottxu.github.io/BulletScreenEngine/
*/
!function l(o,a,s){function c(t,e){if(!a[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var r=a[t]={exports:{}};o[t][0].call(r.exports,function(e){return c(o[t][1][e]||e)},r,r.exports,l,o,a,s)}return a[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)c(s[e]);return c}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BulletScreenEngine=void 0;var B=e("./linkedList"),D=e("./event"),I=e("./version");var F="css3",U="webgl",O="canvas";n.BulletScreenEngine=function e(t,f){var n,y=2<arguments.length&&void 0!==arguments[2]?arguments[2]:O;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i,r,l=0,a=new B.LinkedList,h=new B.LinkedList,s=0,v=0,c=.06,o=!1,u=0;(f=E(f,{})).verticalInterval=E(f.verticalInterval,8),f.playSpeed=E(f.playSpeed,1),f.clock=E(f.clock,function(e){return(new Date).getTime()-n}),f.scaling=E(f.scaling,1),f.timeOutDiscard=E(f.timeOutDiscard,!0),f.defaultStyle=E(f.defaultStyle,{}),f.defaultStyle.shadowBlur=E(f.defaultStyle.shadowBlur,2),f.defaultStyle.fontWeight=E(f.defaultStyle.fontWeight,"600"),f.defaultStyle.fontFamily=E(f.defaultStyle.fontFamily,"sans-serif"),f.defaultStyle.size=E(f.defaultStyle.size,19),f.defaultStyle.boxColor=E(f.defaultStyle.boxColor,null),f.defaultStyle.color=E(f.defaultStyle.color,"white"),f.defaultStyle.borderColor=E(f.defaultStyle.borderColor,null),f.defaultStyle.speed=E(f.defaultStyle.speed,.15),f.defaultStyle.residenceTime=E(f.defaultStyle.residenceTime,5e3),this.options=f;var d,g,p,m=new D.Event;m.add("click"),m.add("contextmenu"),this.bind=m.bind,this.unbind=m.unbind;var T,x,S=t.clientWidth/f.scaling,b=t.clientHeight/f.scaling,w=void 0===window.devicePixelRatio?1:window.devicePixelRatio;function E(e,t){return void 0===e?t:"number"==typeof e&&isNaN(e)?t:null===e?t:e}function _(){var o,e=(new Date).getTime();null!=r&&(c=1/(e-r)),r=e,function(){0===h.getLength()&&(v=0);var e,t=Math.floor(2e3*c);do{var n=a.pop(!1,!1);if(null===n)return;var i=f.clock();if(n.startTime>i)return;!f.timeOutDiscard||!n.canDiscard||n.startTime>i-60*Math.floor(1/c)?((e=n).style=E(e.style,{}),e.style.shadowBlur=E(e.style.shadowBlur,f.defaultStyle.shadowBlur),e.style.fontWeight=E(e.style.fontWeight,f.defaultStyle.fontWeight),e.style.fontFamily=E(e.style.fontFamily,f.defaultStyle.fontFamily),e.style.size=E(e.style.size,f.defaultStyle.size),e.style.boxColor=E(e.style.boxColor,f.defaultStyle.boxColor),e.style.color=E(e.style.color,f.defaultStyle.color),e.style.borderColor=E(e.style.borderColor,f.defaultStyle.borderColor),e.style.speed=E(e.style.speed,f.defaultStyle.speed),e.style.residenceTime=E(e.style.residenceTime,f.defaultStyle.residenceTime),L(i,n)):s++,a.pop(!0,!1),t--}while(0===h.getLength()||0<t)}(),h.forEach(function(e){var t=f.clock();switch(e.bulletScreen.type){case 0:if(!(e.x>-e.width))return y===F&&g.removeChild(e.element),{remove:!0};e.x-=e.bulletScreen.style.speed*f.playSpeed/c;break;case 1:if(!(e.x<S))return y===F&&g.removeChild(e.element),{remove:!0};e.x+=e.bulletScreen.style.speed*f.playSpeed/c;break;case 2:case 3:if(e.endTime<t)return y===F&&g.removeChild(e.element),{remove:!0}}},!0),y===F?h.forEach(function(e){e.element.style.transform=e.element.style.webkitTransform=e.element.style.msTransform="translate(".concat(e.x-4,"px,").concat(e.actualY-4,"px)")},!0):y===O?function(){var e=document.createElement("canvas");e.width=d.width,e.height=d.height;var t=e.getContext("2d");h.forEach(function(e){t.drawImage(e.hideCanvas,(e.x-4)*w,(e.actualY-4)*w,(e.width+8)*w,(e.height+8)*w)},!0);var n=d.getContext("2d");n.clearRect(0,0,d.width,d.height),n.drawImage(e,0,0)}():y===U&&((o=p.webglContext).clear(o.COLOR_BUFFER_BIT),h.forEach(function(e){var t=(e.x-4)*w,n=t+(e.width+8)*w,i=(e.actualY-4)*w,r=i+(e.height+8)*w;o.bindTexture(o.TEXTURE_2D,e.texture2D);var l=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,l),o.enableVertexAttribArray(p.positionAttributeLocation),o.vertexAttribPointer(p.positionAttributeLocation,2,o.FLOAT,!1,0,0),o.bufferData(o.ARRAY_BUFFER,new Float32Array([t,i,n,i,t,r,t,r,n,i,n,r]),o.STATIC_DRAW),o.drawArrays(o.TRIANGLES,0,6)},!0)),i&&requestAnimationFrame(_)}function C(e){var t=e.bulletScreen,n=document.createElement("canvas");n.width=(e.width+8)*w,n.height=(e.height+8)*w;var i=n.getContext("2d");return i.textBaseline="top",i.shadowColor="black",i.font="".concat(t.style.fontWeight," ").concat(e.size*w,"px ").concat(t.style.fontFamily),null!=t.style.color&&(i.shadowBlur=(t.style.shadowBlur+.5)*w,i.fillStyle=t.style.color,i.fillText(t.text,4*w,4*w)),null!=t.style.borderColor&&(i.shadowBlur=0,i.lineWidth=.5*w,i.strokeStyle=t.style.borderColor,i.strokeText(t.text,4*w,4*w)),null!=t.style.boxColor&&(i.shadowBlur=0,i.lineWidth=w,i.strokeStyle=t.style.boxColor,i.strokeRect(w,w,n.width-w,n.height-w)),n}function L(n,t){v=n-t.startTime;var e,i,r,l,o,a,s={};if(s.bulletScreen=t,s.startTime=n,s.size=s.bulletScreen.style.size,s.height=s.size,y===F)s.element=(o=(l=s).bulletScreen,(a=document.createElement("div")).style.position="absolute",a.style.whiteSpace="nowrap",a.style.fontWeight=o.style.fontWeight,a.style.fontSize="".concat(l.size,"px"),a.style.fontFamily=o.style.fontFamily,a.style.lineHeight="".concat(l.size,"px"),a.style.textShadow="0 0 ".concat(o.style.shadowBlur,"px black"),a.style.color=o.style.color,null!=o.style.borderColor&&(a.style.textStroke=a.style.webkitTextStroke="0.5px",a.style.textStrokeColor=a.style.webkitTextStrokeColor=o.borderColor),null!=o.style.boxColor?(a.style.padding="3px",a.style.border="1px solid",a.style.borderColor=o.style.boxColor):a.style.padding="4px",a.innerText=o.text,a.bulletScreen=o,g.appendChild(a),a),s.width=s.element.clientWidth-8;else if(y===O||y===U){var c=document.createElement("canvas").getContext("2d");c.font="".concat(t.style.fontWeight," ").concat(s.size,"px ").concat(t.style.fontFamily),s.width=c.measureText(t.text).width,y===O?s.hideCanvas=C(s):s.texture2D=(e=C(s),i=p.webglContext,r=i.createTexture(),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),r)}switch(t.type){case 0:s.endTime=parseInt(n+(S+s.width)/(t.style.speed*f.playSpeed)),s.x=S,s.y=f.verticalInterval;break;case 1:s.endTime=parseInt(n+(S+s.width)/(t.style.speed*f.playSpeed)),s.x=-s.width,s.y=f.verticalInterval;break;case 2:s.endTime=s.startTime+t.style.residenceTime*f.playSpeed,s.x=parseInt((S-s.width)/2),s.y=f.verticalInterval;break;case 3:s.endTime=s.startTime+t.style.residenceTime*f.playSpeed,s.x=parseInt((S-s.width)/2),s.y=-f.verticalInterval-s.height}var u=h.getLength();if(1<t.type)h.forEach(function(e){if(e.bulletScreen.type==t.type)if(2===t.type){if(s.y+s.height<e.y)return{add:{addToUp:!0,element:R(s)},stop:!0};e.endTime<n?s.y=e.y:s.y=e.y+e.height+f.verticalInterval}else{if(s.y>e.y+e.height)return{add:{addToUp:!0,element:R(s)},stop:!0};e.endTime<n?s.y=e.y:s.y=e.y-s.height-f.verticalInterval}},!0);else{var d=s.width/(t.style.speed*f.playSpeed);h.forEach(function(e){if(!(1<e.bulletScreen.type)){if(s.y+s.height<e.y)return{add:{addToUp:!0,element:R(s)},stop:!0};var t=e.width/(e.bulletScreen.style.speed*f.playSpeed);e.startTime+t>=n||e.endTime>=s.endTime-d?s.y=e.y+e.height+f.verticalInterval:s.y=e.y}},!0)}h.getLength()===u&&h.push(R(s),!1)}function R(e){var t=e.bulletScreen;return t.type<3?e.actualY=e.y%(b-e.height):3===t.type&&(e.actualY=b+e.y%b),e}function A(e){var t=document.createElement("canvas");return t.style.width="".concat(S,"px"),t.style.height="".concat(b,"px"),t.style.transform=t.style.webkitTransform=t.style.msTransform="scale(".concat(f.scaling,",").concat(f.scaling,")"),t.style.transformOrigin=t.style.webkitTransformOrigin=t.style.msTransformOrigin="left top",t.style.position="relative",t.width=S*w,t.height=b*w,k(t,!1),e.innerHTML="",e.appendChild(t),t}function k(e,t){function n(l){var o=null;return h.forEach(function(e){var t=e.x-4,n=t+e.width+8,i=e.actualY-4,r=i+e.height+8;if(l.x>=t&&l.x<=n&&l.y>=i&&l.y<=r)return o=e.bulletScreen,{stop:!0}},!1),o}function i(e){if(void 0===e.offsetX||null===e.offsetX){if(void 0===e.layerX||null===e.layerX){if(void 0===e.pageX||null===e.pageX){var t=document.documentElement,n=document.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}e.layerX=e.pageX-function(e){for(var t=0;t+=e.offsetLeft,null!=(e=e.offsetParent););return t}(e.target),e.layerY=e.pageY-function(e){for(var t=0;t+=e.offsetTop,null!=(e=e.offsetParent););return t}(e.target)}e.offsetX=e.layerX-e.target.clientLeft,e.offsetY=e.layerY-e.target.clientTop}return{x:e.offsetX,y:e.offsetY}}e.onclick=t?(e.oncontextmenu=function(e){return e.target!=this&&m.trigger("contextmenu",{bulletScreen:e.target.bulletScreen}),!1},function(e){return e.target!=this&&m.trigger("click",{bulletScreen:e.target.bulletScreen}),!1}):(e.oncontextmenu=function(e){var t=n(i(e));return t&&m.trigger("contextmenu",{bulletScreen:t}),!1},function(e){var t=n(i(e));return t&&m.trigger("click",{bulletScreen:t}),!1})}w*=f.scaling,y===F?(T=t,(x=document.createElement("div")).style.width="".concat(S,"px"),x.style.height="".concat(b,"px"),x.style.transform=x.style.webkitTransform=x.style.msTransform="scale(".concat(f.scaling,",").concat(f.scaling,")"),x.style.transformOrigin=x.style.webkitTransformOrigin=x.style.msTransformOrigin="left top",x.style.overflow="hidden",x.style.position="relative",x.style.padding="0",x.style.margin="0",x.style.webkitUserSelect="none",k(x,!0),T.innerHTML="",T.appendChild(x),g=x):y===O?d=A(t):y===U&&(p=function(e){var t=function(e,t,n){var i=e.createShader(t);e.shaderSource(i,n),e.compileShader(i);var r=e.getShaderParameter(i,e.COMPILE_STATUS);if(r)return i;e.deleteShader(i)},n=A(e),i=n.getContext("webgl");i.enable(i.BLEND),i.clearColor(0,0,0,0),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA);var r=t(i,i.VERTEX_SHADER,"attribute vec2 a_position;attribute vec2 a_texcoord;uniform vec2 u_resolution;varying vec2 v_texcoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texcoord = a_texcoord;}"),l=t(i,i.FRAGMENT_SHADER,"precision mediump float;varying vec2 v_texcoord;uniform sampler2D u_texture;void main() {gl_FragColor = texture2D(u_texture, v_texcoord);}"),o=function(e,t,n){var i=e.createProgram();if(e.attachShader(i,t),e.attachShader(i,n),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS))return i;e.deleteProgram(i)}(i,r,l);i.useProgram(o);var a=i.getAttribLocation(o,"a_position"),s=i.getAttribLocation(o,"a_texcoord"),c=i.getUniformLocation(o,"u_resolution");i.viewport(0,0,n.width,n.height),i.uniform2f(c,n.width,n.height);var u=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,u),i.enableVertexAttribArray(s),i.vertexAttribPointer(s,2,i.FLOAT,!1,0,0),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW),{canvas:n,positionAttributeLocation:a,resolutionUniformLocation:c,webglContext:i}}(t)),setInterval(function(){var e=void 0===window.devicePixelRatio?1:window.devicePixelRatio;e*=f.scaling,(S!=t.clientWidth/f.scaling||b!=t.clientHeight/f.scaling||w!=e)&&(S=t.clientWidth/f.scaling,b=t.clientHeight/f.scaling,w=e,y===F?(g.style.width="".concat(S,"px"),g.style.height="".concat(b,"px"),g.style.transform=g.style.webkitTransform=g.style.msTransform="scale(".concat(f.scaling,",").concat(f.scaling,")")):y===O?(d.style.width="".concat(S,"px"),d.style.height="".concat(b,"px"),d.style.transform=d.style.webkitTransform=d.style.msTransform="scale(".concat(f.scaling,",").concat(f.scaling,")"),d.width=S*w,d.height=b*w):y===U&&(p.canvas.style.width="".concat(S,"px"),p.canvas.style.height="".concat(b,"px"),p.canvas.style.transform=p.canvas.style.webkitTransform=p.canvas.style.msTransform="scale(".concat(f.scaling,",").concat(f.scaling,")"),p.canvas.width=S*w,p.canvas.height=b*w,p.webglContext.viewport(0,0,S,b),p.webglContext.uniform2f(p.resolutionUniformLocation,p.canvas.width,p.canvas.height)))},100),console.info("%cBulletScreenEngine%c now loaded.\n\n%cVersion: %s\nBuild Date: %s\n\n%cBulletScreenEngine is a high-performance JavaScript bullet-screen (danmaku) engine.\nHome: https://iamscottxu.github.io/BulletScreenEngine/","font-weight:bold; color:#0099FF;","","font-style:italic;",I.VERSION,I.BUILE_DATE,""),this.addBulletScreen=function(t){if((t=E(t,{})).text=E(t.text,"Empty"),t.canDiscard=E(t.canDiscard,!0),t.startTime=E(t.startTime,f.clock()),t.type=E(t.type,0),t.type<=3){var e=a.getLength();a.forEach(function(e){if(t.startTime>e.startTime)return{add:{addToUp:!0,element:t},stop:!0}},!0),e===a.getLength()&&a.push(t,!1)}},this.play=function(){i||(n||(n=(new Date).getTime()),l&&(n+=f.clock()-l),i=!(r=null),requestAnimationFrame(_))},this.pause=function(){i&&(l=f.clock(),i=!1)},this.cleanBulletScreenList=function(){a.clean()},this.cleanBulletScreenListOnScreen=function(){h.clean(),y===F?g.innerHTML="":y===O?d.getContext("2d").clearRect(0,0,d.width,d.height):y===U&&p.webglContext.clear(webglContext.COLOR_BUFFER_BIT)},this.stop=function(){i&&this.pause(),this.cleanBulletScreenList(),this.cleanBulletScreenListOnScreen(),l=0,n=null},this.hide=function(){o=!0,y===F?g.style.visibility="hidden":y===O?d.style.visibility="hidden":y===U&&(p.canvas.style.visibility="hidden")},this.show=function(){o=!1,y===F?g.style.visibility="visible":y===O?d.style.visibility="visible":y===U&&(p.canvas.style.visibility="visible")},this.setOpacity=function(e){u=e,y===F?g.style.opacity=e:y===O?d.style.opacity=e:y===U&&(p.canvas.style.opacity=e)},this.getOpacity=function(){return u},this.getVisibility=function(){return!o},this.getRenderMode=function(){return y},this.getPlayState=function(){return i},this.getDebugInfo=function(){return{time:i?f.clock():l,bulletScreensOnScreenCount:h.getLength(),bulletScreensCount:a.getLength(),delay:v,delayBulletScreensCount:s,fps:i?Math.floor(1e3*c):0}},this.getVersion=function(){return{version:I.VERSION,buildDate:I.BUILE_DATE}}}},{"./event":4,"./linkedList":5,"./version":6}],2:[function(e,t,n){"use strict";var i=e("./BulletScreenEngine");window.BulletScreenEngine=i.BulletScreenEngine},{"./BulletScreenEngine":1}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BulletScreenEngine=void 0;var B=e("./linkedList"),D=e("./event"),I=e("./version");var F="css3",U="webgl",O="canvas";n.BulletScreenEngine=function e(t,f){var n,y=2<arguments.length&&void 0!==arguments[2]?arguments[2]:O;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i,r,l=0,a=new B.LinkedList,h=new B.LinkedList,s=0,v=0,c=.06,o=!1,u=0;(f=E(f,{})).verticalInterval=E(f.verticalInterval,8),f.playSpeed=E(f.playSpeed,1),f.clock=E(f.clock,function(e){return(new Date).getTime()-n}),f.scaling=E(f.scaling,1),f.timeOutDiscard=E(f.timeOutDiscard,!0),f.defaultStyle=E(f.defaultStyle,{}),f.defaultStyle.shadowBlur=E(f.defaultStyle.shadowBlur,2),f.defaultStyle.fontWeight=E(f.defaultStyle.fontWeight,"600"),f.defaultStyle.fontFamily=E(f.defaultStyle.fontFamily,"sans-serif"),f.defaultStyle.size=E(f.defaultStyle.size,19),f.defaultStyle.boxColor=E(f.defaultStyle.boxColor,null),f.defaultStyle.color=E(f.defaultStyle.color,"white"),f.defaultStyle.borderColor=E(f.defaultStyle.borderColor,null),f.defaultStyle.speed=E(f.defaultStyle.speed,.15),f.defaultStyle.residenceTime=E(f.defaultStyle.residenceTime,5e3),this.options=f;var d,g,p,m=new D.Event;m.add("click"),m.add("contextmenu"),this.bind=m.bind,this.unbind=m.unbind;var T,x,S=t.clientWidth/f.scaling,b=t.clientHeight/f.scaling,w=void 0===window.devicePixelRatio?1:window.devicePixelRatio;function E(e,t){return void 0===e?t:"number"==typeof e&&isNaN(e)?t:null===e?t:e}function _(){var o,e=(new Date).getTime();null!=r&&(c=1/(e-r)),r=e,function(){0===h.getLength()&&(v=0);var e,t=Math.floor(2e3*c);do{var n=a.pop(!1,!1);if(null===n)return;var i=f.clock();if(n.startTime>i)return;!f.timeOutDiscard||!n.canDiscard||n.startTime>i-60*Math.floor(1/c)?((e=n).style=E(e.style,{}),e.style.shadowBlur=E(e.style.shadowBlur,f.defaultStyle.shadowBlur),e.style.fontWeight=E(e.style.fontWeight,f.defaultStyle.fontWeight),e.style.fontFamily=E(e.style.fontFamily,f.defaultStyle.fontFamily),e.style.size=E(e.style.size,f.defaultStyle.size),e.style.boxColor=E(e.style.boxColor,f.defaultStyle.boxColor),e.style.color=E(e.style.color,f.defaultStyle.color),e.style.borderColor=E(e.style.borderColor,f.defaultStyle.borderColor),e.style.speed=E(e.style.speed,f.defaultStyle.speed),e.style.residenceTime=E(e.style.residenceTime,f.defaultStyle.residenceTime),L(i,n)):s++,a.pop(!0,!1),t--}while(0===h.getLength()||0<t)}(),h.forEach(function(e){var t=f.clock();switch(e.bulletScreen.type){case 0:if(!(e.x>-e.width))return y===F&&g.removeChild(e.element),{remove:!0};e.x-=e.bulletScreen.style.speed*f.playSpeed/c;break;case 1:if(!(e.x<S))return y===F&&g.removeChild(e.element),{remove:!0};e.x+=e.bulletScreen.style.speed*f.playSpeed/c;break;case 2:case 3:if(e.endTime<t)return y===F&&g.removeChild(e.element),{remove:!0}}},!0),y===F?h.forEach(function(e){e.element.style.transform=e.element.style.webkitTransform=e.element.style.msTransform="translate(".concat(e.x-4,"px,").concat(e.actualY-4,"px)")},!0):y===O?function(){var e=document.createElement("canvas");e.width=d.width,e.height=d.height;var t=e.getContext("2d");h.forEach(function(e){t.drawImage(e.hideCanvas,(e.x-4)*w,(e.actualY-4)*w,(e.width+8)*w,(e.height+8)*w)},!0);var n=d.getContext("2d");n.clearRect(0,0,d.width,d.height),n.drawImage(e,0,0)}():y===U&&((o=p.webglContext).clear(o.COLOR_BUFFER_BIT),h.forEach(function(e){var t=(e.x-4)*w,n=t+(e.width+8)*w,i=(e.actualY-4)*w,r=i+(e.height+8)*w;o.bindTexture(o.TEXTURE_2D,e.texture2D);var l=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,l),o.enableVertexAttribArray(p.positionAttributeLocation),o.vertexAttribPointer(p.positionAttributeLocation,2,o.FLOAT,!1,0,0),o.bufferData(o.ARRAY_BUFFER,new Float32Array([t,i,n,i,t,r,t,r,n,i,n,r]),o.STATIC_DRAW),o.drawArrays(o.TRIANGLES,0,6)},!0)),i&&requestAnimationFrame(_)}function C(e){var t=e.bulletScreen,n=document.createElement("canvas");n.width=(e.width+8)*w,n.height=(e.height+8)*w;var i=n.getContext("2d");return i.textBaseline="top",i.shadowColor="black",i.font="".concat(t.style.fontWeight," ").concat(e.size*w,"px ").concat(t.style.fontFamily),null!=t.style.color&&(i.shadowBlur=(t.style.shadowBlur+.5)*w,i.fillStyle=t.style.color,i.fillText(t.text,4*w,4*w)),null!=t.style.borderColor&&(i.shadowBlur=0,i.lineWidth=.5*w,i.strokeStyle=t.style.borderColor,i.strokeText(t.text,4*w,4*w)),null!=t.style.boxColor&&(i.shadowBlur=0,i.lineWidth=w,i.strokeStyle=t.style.boxColor,i.strokeRect(w,w,n.width-w,n.height-w)),n}function L(n,t){v=n-t.startTime;var e,i,r,l,o,a,s={};if(s.bulletScreen=t,s.startTime=n,s.size=s.bulletScreen.style.size,s.height=s.size,y===F)s.element=(o=(l=s).bulletScreen,(a=document.createElement("div")).style.position="absolute",a.style.whiteSpace="nowrap",a.style.fontWeight=o.style.fontWeight,a.style.fontSize="".concat(l.size,"px"),a.style.fontFamily=o.style.fontFamily,a.style.lineHeight="".concat(l.size,"px"),a.style.textShadow="0 0 ".concat(o.style.shadowBlur,"px black"),a.style.color=o.style.color,null!=o.style.borderColor&&(a.style.textStroke=a.style.webkitTextStroke="0.5px",a.style.textStrokeColor=a.style.webkitTextStrokeColor=o.borderColor),null!=o.style.boxColor?(a.style.padding="3px",a.style.border="1px solid",a.style.borderColor=o.style.boxColor):a.style.padding="4px",a.innerText=o.text,a.bulletScreen=o,g.appendChild(a),a),s.width=s.element.clientWidth-8;else if(y===O||y===U){var c=document.createElement("canvas").getContext("2d");c.font="".concat(t.style.fontWeight," ").concat(s.size,"px ").concat(t.style.fontFamily),s.width=c.measureText(t.text).width,y===O?s.hideCanvas=C(s):s.texture2D=(e=C(s),i=p.webglContext,r=i.createTexture(),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),r)}switch(t.type){case 0:s.endTime=parseInt(n+(S+s.width)/(t.style.speed*f.playSpeed)),s.x=S,s.y=f.verticalInterval;break;case 1:s.endTime=parseInt(n+(S+s.width)/(t.style.speed*f.playSpeed)),s.x=-s.width,s.y=f.verticalInterval;break;case 2:s.endTime=s.startTime+t.style.residenceTime*f.playSpeed,s.x=parseInt((S-s.width)/2),s.y=f.verticalInterval;break;case 3:s.endTime=s.startTime+t.style.residenceTime*f.playSpeed,s.x=parseInt((S-s.width)/2),s.y=-f.verticalInterval-s.height}var u=h.getLength();if(1<t.type)h.forEach(function(e){if(e.bulletScreen.type==t.type)if(2===t.type){if(s.y+s.height<e.y)return{add:{addToUp:!0,element:R(s)},stop:!0};e.endTime<n?s.y=e.y:s.y=e.y+e.height+f.verticalInterval}else{if(s.y>e.y+e.height)return{add:{addToUp:!0,element:R(s)},stop:!0};e.endTime<n?s.y=e.y:s.y=e.y-s.height-f.verticalInterval}},!0);else{var d=s.width/(t.style.speed*f.playSpeed);h.forEach(function(e){if(!(1<e.bulletScreen.type)){if(s.y+s.height<e.y)return{add:{addToUp:!0,element:R(s)},stop:!0};var t=e.width/(e.bulletScreen.style.speed*f.playSpeed);e.startTime+t>=n||e.endTime>=s.endTime-d?s.y=e.y+e.height+f.verticalInterval:s.y=e.y}},!0)}h.getLength()===u&&h.push(R(s),!1)}function R(e){var t=e.bulletScreen;return t.type<3?e.actualY=e.y%(b-e.height):3===t.type&&(e.actualY=b+e.y%b),e}function A(e){var t=document.createElement("canvas");return t.style.width="".concat(S,"px"),t.style.height="".concat(b,"px"),t.style.transform=t.style.webkitTransform=t.style.msTransform="scale(".concat(f.scaling,",").concat(f.scaling,")"),t.style.transformOrigin=t.style.webkitTransformOrigin=t.style.msTransformOrigin="left top",t.style.position="relative",t.width=S*w,t.height=b*w,k(t,!1),e.innerHTML="",e.appendChild(t),t}function k(e,t){function n(l){var o=null;return h.forEach(function(e){var t=e.x-4,n=t+e.width+8,i=e.actualY-4,r=i+e.height+8;if(l.x>=t&&l.x<=n&&l.y>=i&&l.y<=r)return o=e.bulletScreen,{stop:!0}},!1),o}function i(e){if(void 0===e.offsetX||null===e.offsetX){if(void 0===e.layerX||null===e.layerX){if(void 0===e.pageX||null===e.pageX){var t=document.documentElement,n=document.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}e.layerX=e.pageX-function(e){for(var t=0;t+=e.offsetLeft,null!=(e=e.offsetParent););return t}(e.target),e.layerY=e.pageY-function(e){for(var t=0;t+=e.offsetTop,null!=(e=e.offsetParent););return t}(e.target)}e.offsetX=e.layerX-e.target.clientLeft,e.offsetY=e.layerY-e.target.clientTop}return{x:e.offsetX,y:e.offsetY}}e.onclick=t?(e.oncontextmenu=function(e){return e.target!=this&&m.trigger("contextmenu",{bulletScreen:e.target.bulletScreen}),!1},function(e){return e.target!=this&&m.trigger("click",{bulletScreen:e.target.bulletScreen}),!1}):(e.oncontextmenu=function(e){var t=n(i(e));return t&&m.trigger("contextmenu",{bulletScreen:t}),!1},function(e){var t=n(i(e));return t&&m.trigger("click",{bulletScreen:t}),!1})}w*=f.scaling,y===F?(T=t,(x=document.createElement("div")).style.width="".concat(S,"px"),x.style.height="".concat(b,"px"),x.style.transform=x.style.webkitTransform=x.style.msTransform="scale(".concat(f.scaling,",").concat(f.scaling,")"),x.style.transformOrigin=x.style.webkitTransformOrigin=x.style.msTransformOrigin="left top",x.style.overflow="hidden",x.style.position="relative",x.style.padding="0",x.style.margin="0",x.style.webkitUserSelect="none",k(x,!0),T.innerHTML="",T.appendChild(x),g=x):y===O?d=A(t):y===U&&(p=function(e){var t=function(e,t,n){var i=e.createShader(t);e.shaderSource(i,n),e.compileShader(i);var r=e.getShaderParameter(i,e.COMPILE_STATUS);if(r)return i;e.deleteShader(i)},n=A(e),i=n.getContext("webgl");i.enable(i.BLEND),i.clearColor(0,0,0,0),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA);var r=t(i,i.VERTEX_SHADER,"attribute vec2 a_position;attribute vec2 a_texcoord;uniform vec2 u_resolution;varying vec2 v_texcoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texcoord = a_texcoord;}"),l=t(i,i.FRAGMENT_SHADER,"precision mediump float;varying vec2 v_texcoord;uniform sampler2D u_texture;void main() {gl_FragColor = texture2D(u_texture, v_texcoord);}"),o=function(e,t,n){var i=e.createProgram();if(e.attachShader(i,t),e.attachShader(i,n),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS))return i;e.deleteProgram(i)}(i,r,l);i.useProgram(o);var a=i.getAttribLocation(o,"a_position"),s=i.getAttribLocation(o,"a_texcoord"),c=i.getUniformLocation(o,"u_resolution");i.viewport(0,0,n.width,n.height),i.uniform2f(c,n.width,n.height);var u=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,u),i.enableVertexAttribArray(s),i.vertexAttribPointer(s,2,i.FLOAT,!1,0,0),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW),{canvas:n,positionAttributeLocation:a,resolutionUniformLocation:c,webglContext:i}}(t)),setInterval(function(){var e=void 0===window.devicePixelRatio?1:window.devicePixelRatio;e*=f.scaling,(S!=t.clientWidth/f.scaling||b!=t.clientHeight/f.scaling||w!=e)&&(S=t.clientWidth/f.scaling,b=t.clientHeight/f.scaling,w=e,y===F?(g.style.width="".concat(S,"px"),g.style.height="".concat(b,"px"),g.style.transform=g.style.webkitTransform=g.style.msTransform="scale(".concat(f.scaling,",").concat(f.scaling,")")):y===O?(d.style.width="".concat(S,"px"),d.style.height="".concat(b,"px"),d.style.transform=d.style.webkitTransform=d.style.msTransform="scale(".concat(f.scaling,",").concat(f.scaling,")"),d.width=S*w,d.height=b*w):y===U&&(p.canvas.style.width="".concat(S,"px"),p.canvas.style.height="".concat(b,"px"),p.canvas.style.transform=p.canvas.style.webkitTransform=p.canvas.style.msTransform="scale(".concat(f.scaling,",").concat(f.scaling,")"),p.canvas.width=S*w,p.canvas.height=b*w,p.webglContext.viewport(0,0,S,b),p.webglContext.uniform2f(p.resolutionUniformLocation,p.canvas.width,p.canvas.height)))},100),console.info("%cBulletScreenEngine%c now loaded.\n\n%cVersion: %s\nBuild Date: %s\n\n%cBulletScreenEngine is a high-performance JavaScript bullet-screen (danmaku) engine.\nHome: https://iamscottxu.github.io/BulletScreenEngine/","font-weight:bold; color:#0099FF;","","font-style:italic;",I.VERSION,I.BUILE_DATE,""),this.addBulletScreen=function(t){if((t=E(t,{})).text=E(t.text,"Empty"),t.canDiscard=E(t.canDiscard,!0),t.startTime=E(t.startTime,f.clock()),t.type=E(t.type,0),t.type<=3){var e=a.getLength();a.forEach(function(e){if(t.startTime>e.startTime)return{add:{addToUp:!0,element:t},stop:!0}},!0),e===a.getLength()&&a.push(t,!1)}},this.play=function(){i||(n||(n=(new Date).getTime()),l&&(n+=f.clock()-l),i=!(r=null),requestAnimationFrame(_))},this.pause=function(){i&&(l=f.clock(),i=!1)},this.cleanBulletScreenList=function(){a.clean()},this.cleanBulletScreenListOnScreen=function(){h.clean(),y===F?g.innerHTML="":y===O?d.getContext("2d").clearRect(0,0,d.width,d.height):y===U&&p.webglContext.clear(webglContext.COLOR_BUFFER_BIT)},this.stop=function(){i&&this.pause(),this.cleanBulletScreenList(),this.cleanBulletScreenListOnScreen(),l=0,n=null},this.hide=function(){o=!0,y===F?g.style.visibility="hidden":y===O?d.style.visibility="hidden":y===U&&(p.canvas.style.visibility="hidden")},this.show=function(){o=!1,y===F?g.style.visibility="visible":y===O?d.style.visibility="visible":y===U&&(p.canvas.style.visibility="visible")},this.setOpacity=function(e){u=e,y===F?g.style.opacity=e:y===O?d.style.opacity=e:y===U&&(p.canvas.style.opacity=e)},this.getOpacity=function(){return u},this.getVisibility=function(){return!o},this.getRenderMode=function(){return y},this.getPlayState=function(){return i},this.getDebugInfo=function(){return{time:i?f.clock():l,bulletScreensOnScreenCount:h.getLength(),bulletScreensCount:a.getLength(),delay:v,delayBulletScreensCount:s,fps:i?Math.floor(1e3*c):0}},this.getVersion=function(){return{version:I.VERSION,buildDate:I.BUILE_DATE}}}},{"./event":4,"./linkedList":5,"./version":6}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Event=void 0;n.Event=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var s={};this.add=function(e){return void 0===s[e]&&(s[e]=[],!0)},this.remove=function(e){return void 0!==s[e]&&(delete s[e],!0)},this.bind=function(e,t){var n=s[e];if(void 0===n||"function"!=typeof t)return!1;for(var i in n)if(n[i]===t)return!1;return n.push(t)},this.unbind=function(e,t){var n=s[e];if(void 0===n)return!1;if("function"!=typeof t)return s[e]=[],!0;for(var i in n)if(n[i]===t)return n.splice(t,1),n.length},this.trigger=function(e,t){var n=s[e];if(void 0===n)return!1;var i=!0,r=!1,l=void 0;try{for(var o,a=n[Symbol.iterator]();!(i=(o=a.next()).done);i=!0)if(!(0,o.value)(t))return!0}catch(e){r=!0,l=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw l}}return!0}}},{}],5:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.LinkedList=void 0;n.LinkedList=function e(){i(this,e);var l=function e(t){i(this,e),this.element=t,this.next=null,this.previous=null},o=new l(null),a=new l(null),s=0;(o.next=a).previous=o,this.getLength=function(e){return s},this.push=function(e,t){var n=new l(e);t?(n.next=o.next,(n.previous=o).next=o.next.previous=n):(n.previous=a.previous,(n.next=a).previous=a.previous.next=n),s++},this.pop=function(e,t){var n;return t?(n=o.next,o.next!=a&&e&&((n.next.previous=o).next=n.next)):(n=a.previous,a.previous!=o&&e&&((n.previous.next=a).previous=n.previous)),e&&s--,n.element},this.clean=function(){o=new l(null),a=new l(null),(o.next=a).previous=o,s=0},this.forEach=function(e,t){for(var n=t?o:a;t?(n=n.next)!=a:(n=n.previous)!=o;){var i=e(n.element);if(i){if(i.add){var r=new l(i.add.element);i.add.addToUp?(r.previous=n.previous,(r.next=n).previous.next=r,n.previous=r):(r.previous=n,r.next=n.next,n.next.previous=r,n.next=r),s++}if(i.remove&&(n.previous.next=n.next,n.next.previous=n.previous,s--),i.stop)return}}}}},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BUILE_DATE=n.VERSION=void 0;n.VERSION="2.0-Alpha";n.BUILE_DATE="Tue, 08 Jan 2019 14:59:26 GMT"},{}]},{},[2,3]);