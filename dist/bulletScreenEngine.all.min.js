/*!
MIT License

Copyright (c) 2018-2019 Scott Xu

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

Home: https://iamscottxu.github.io/BulletScreenEngine/
*/
!function l(o,a,c){function s(t,e){if(!a[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var r=a[t]={exports:{}};o[t][0].call(r.exports,function(e){return s(o[t][1][e]||e)},r,r.exports,l,o,a,c)}return a[t].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)s(c[e]);return s}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BulletScreenEngine=void 0;var C=e("./linkedList"),B=e("./event"),D=e("./version");n.BulletScreenEngine=function(e,h){var t,n,i,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"canvas",r=0,l=new C.LinkedList,v=new C.LinkedList,a=0,p=0,c=.06,o=!1,s=0;(h=S(h,{})).verticalInterval=S(h.verticalInterval,8),h.playSpeed=S(h.playSpeed,1),h.clock=S(h.clock,function(e){return(new Date).getTime()-t}),h.shadowBlur=S(h.shadowBlur,2),h.scaling=S(h.scaling,1),h.timeOutDiscard=S(h.timeOutDiscard,!0),h.fontWeight=S(h.fontWeight,600),h.fontFamily=S(h.fontFamily,"sans-serif"),this.option=h;var u,g,y,d=new B.Event;d.add("click"),d.add("contextmenu"),this.bind=d.bind,this.unbind=d.unbind;var m,b,x=e.clientWidth,T=e.clientHeight;function S(e,t){return void 0===e?t:"number"==typeof e&&isNaN(e)?t:null===e?t:e}function w(){var o,e=(new Date).getTime();null!=i&&(c=1/(e-i)),i=e,function(){0==v.getLength()&&(p=0);var e=.02<c?Math.ceil(1/c):1;do{var t=l.pop(!1,!1);if(null==t)return;var n=h.clock();if(t.startTime>n)return;!h.timeOutDiscard||!t.canDiscard||t.startTime>n-1/c*1.5?_(n,t):a++,l.pop(!0,!1),e--}while(0==v.getLength()||0<e)}(),v.forEach(function(e){var t=h.clock();switch(e.bulletScreen.type){case 0:if(!(e.x>-e.width))return"css3"===f&&g.removeChild(e.element),{remove:!0};e.x-=e.bulletScreen.speed*h.playSpeed/c;break;case 1:if(!(e.x<x))return"css3"===f&&g.removeChild(e.element),{remove:!0};e.x+=e.bulletScreen.speed*h.playSpeed/c;break;case 2:case 3:if(e.endTime<t)return"css3"===f&&g.removeChild(e.element),{remove:!0}}},!0),"css3"===f?v.forEach(function(e){e.element.style.transform="translate("+(e.x-4)+"px,"+(e.actualY-4)+"px)"},!0):"canvas"===f?function(){var e=document.createElement("canvas");e.width=u.width,e.height=u.height;var t=e.getContext("2d");v.forEach(function(e){t.drawImage(e.hideCanvas,e.x-4,e.actualY-4)},!0);var n=u.getContext("2d");n.clearRect(0,0,x,T),n.drawImage(e,0,0)}():"webgl"===f&&((o=y.webglContext).clear(o.COLOR_BUFFER_BIT),v.forEach(function(e){var t=e.x-4,n=t+e.width+8,i=e.actualY-4,r=i+e.height+8;o.bindTexture(o.TEXTURE_2D,e.texture2D);var l=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,l),o.enableVertexAttribArray(y.positionAttributeLocation),o.vertexAttribPointer(y.positionAttributeLocation,2,o.FLOAT,!1,0,0),o.bufferData(o.ARRAY_BUFFER,new Float32Array([t,i,n,i,t,r,t,r,n,i,n,r]),o.STATIC_DRAW),o.drawArrays(o.TRIANGLES,0,6)},!0)),n&&requestAnimationFrame(w)}function E(e){var t=document.createElement("canvas");t.width=e.width+8,t.height=e.height+8;var n=t.getContext("2d");return n.textBaseline="top",n.shadowColor="black",n.font=h.fontWeight+" "+e.size.toString()+"px "+h.fontFamily,null!=e.bulletScreen.color&&(n.shadowBlur=h.shadowBlur+.5,n.fillStyle=e.bulletScreen.color,n.fillText(e.bulletScreen.text,4,4)),null!=e.bulletScreen.borderColor&&(n.shadowBlur=0,n.lineWidth=.5,n.strokeStyle=e.bulletScreen.borderColor,n.strokeText(e.bulletScreen.text,4,4)),null!=e.bulletScreen.boxColor&&(n.shadowBlur=0,n.lineWidth=2,n.strokeStyle=e.bulletScreen.boxColor,n.strokeRect(0,0,e.width+8,e.height+8)),t}function _(n,t){p=n-t.startTime;var e,i,r,l,o,a,c={};if(c.bulletScreen=t,c.startTime=n,c.size=c.bulletScreen.size*h.scaling,c.height=c.size,"css3"===f)c.element=(o=(l=c).bulletScreen,(a=document.createElement("div")).style.position="absolute",a.style.whiteSpace="nowrap",a.style.fontWeight=h.fontWeight,a.style.fontSize=l.size.toString()+"px",a.style.fontFamily=h.fontFamily,a.style.lineHeight=l.size.toString()+"px",a.style.textShadow="0 0 "+h.shadowBlur.toString()+"px black",null==o.color?a.style.color="rgba(0,0,0,0)":a.style.color=o.color,null!=o.borderColor&&(a.style.webkitTextStroke="0.5px",a.style.webkitTextStrokeColor=o.borderColor),null!=o.boxColor?(a.style.padding="3px",a.style.border="1px solid",a.style.borderColor=o.boxColor):a.style.padding="4px",a.innerText=o.text,a.bulletScreen=o,g.appendChild(a),a),c.width=c.element.clientWidth-8;else if("canvas"===f||"webgl"===f){var s=document.createElement("canvas").getContext("2d");s.font=h.fontWeight+" "+c.size.toString()+"px "+h.fontFamily,c.width=s.measureText(t.text).width,"canvas"===f?c.hideCanvas=E(c):c.texture2D=(e=E(c),i=y.webglContext,r=i.createTexture(),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),r)}switch(c.endTime=parseInt(n+(x+c.width)/(t.speed*h.playSpeed)),t.type){case 0:c.endTime=parseInt(n+(x+c.width)/(t.speed*h.playSpeed)),c.x=x,c.y=h.verticalInterval*h.scaling;break;case 1:c.endTime=parseInt(n+(x+c.width)/(t.speed*h.playSpeed)),c.x=-c.width,c.y=h.verticalInterval*h.scaling;break;case 2:c.endTime=c.startTime+t.residenceTime,c.x=parseInt((x-c.width)/2),c.y=h.verticalInterval*h.scaling;break;case 3:c.endTime=c.startTime+t.residenceTime,c.x=parseInt((x-c.width)/2),c.y=-h.verticalInterval*h.scaling-c.height}var u=v.getLength();if(1<t.type)v.forEach(function(e){if(e.bulletScreen.type==t.type)if(2==t.type){if(c.y+c.height<e.y)return{add:{addToUp:!0,element:L(c)},stop:!0};e.endTime<n?c.y=e.y:c.y=e.y+e.height+h.verticalInterval*h.scaling}else{if(c.y>e.y+e.height)return{add:{addToUp:!0,element:L(c)},stop:!0};e.endTime<n?c.y=e.y:c.y=e.y-c.height-h.verticalInterval*h.scaling}},!0);else{var d=c.width/(c.bulletScreen.speed*h.playSpeed);v.forEach(function(e){if(!(1<e.bulletScreen.type)){if(c.y+c.height<e.y)return{add:{addToUp:!0,element:L(c)},stop:!0};var t=e.width/(e.bulletScreen.speed*h.playSpeed);e.startTime+t>=n||e.endTime>=c.endTime-d?c.y=e.y+e.height+h.verticalInterval*h.scaling:c.y=e.y}},!0)}v.getLength()==u&&v.push(L(c),!1)}function L(e){var t=e.bulletScreen;return t.type<3?e.actualY=e.y%(T-e.height):3==t.type&&(e.actualY=T+e.y%T),e}function A(e){var t=document.createElement("canvas");return t.style.width=x+"px",t.style.height=T+"px",t.style.position="relative",t.width=x,t.height=T,R(t,!1),e.innerHTML="",e.appendChild(t),t}function R(e,t){function n(l){var o=null;return v.forEach(function(e){var t=e.x-4,n=t+e.width+8,i=e.actualY-4,r=i+e.height+8;if(l.x>=t&&l.x<=n&&l.y>=i&&l.y<=r)return o=e.bulletScreen,{stop:!0}},!1),o}function i(e){if(void 0===e.offsetX||null===e.offsetX){if(void 0===e.layerX||null===e.layerX){if(void 0===e.pageX||null===e.pageX){var t=document.documentElement,n=document.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}e.layerX=e.pageX-function(e){for(var t=0;t+=e.offsetLeft,null!=(e=e.offsetParent););return t}(e.target),e.layerY=e.pageY-function(e){for(var t=0;t+=e.offsetTop,null!=(e=e.offsetParent););return t}(e.target)}e.offsetX=e.layerX-e.target.clientLeft,e.offsetY=e.layerY-e.target.clientTop}return{x:e.offsetX,y:e.offsetY}}e.onclick=t?(e.oncontextmenu=function(e){return e.target!=this&&d.trigger("contextmenu",{bulletScreen:e.target.bulletScreen}),!1},function(e){return e.target!=this&&d.trigger("click",{bulletScreen:e.target.bulletScreen}),!1}):(e.oncontextmenu=function(e){var t=n(i(e));return t&&d.trigger("contextmenu",{bulletScreen:t}),!1},function(e){var t=n(i(e));return t&&d.trigger("click",{bulletScreen:t}),!1})}"css3"==f?(m=e,(b=document.createElement("div")).style.width=x+"px",b.style.height=T+"px",b.style.overflow="hidden",b.style.position="relative",b.style.padding="0",b.style.margin="0",b.style.webkitUserSelect="none",R(b,!0),m.innerHTML="",m.appendChild(b),g=b):"canvas"==f?u=A(e):"webgl"==f&&(y=function(e){var t=function(e,t,n){var i=e.createShader(t);e.shaderSource(i,n),e.compileShader(i);var r=e.getShaderParameter(i,e.COMPILE_STATUS);if(r)return i;e.deleteShader(i)},n=A(e),i=n.getContext("webgl");i.enable(i.BLEND),i.clearColor(0,0,0,0),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA);var r=t(i,i.VERTEX_SHADER,"attribute vec2 a_position;attribute vec2 a_texcoord;uniform vec2 u_resolution;varying vec2 v_texcoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texcoord = a_texcoord;}"),l=t(i,i.FRAGMENT_SHADER,"precision mediump float;varying vec2 v_texcoord;uniform sampler2D u_texture;void main() {gl_FragColor = texture2D(u_texture, v_texcoord);}"),o=function(e,t,n){var i=e.createProgram();if(e.attachShader(i,t),e.attachShader(i,n),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS))return i;e.deleteProgram(i)}(i,r,l);i.useProgram(o);var a=i.getAttribLocation(o,"a_position"),c=i.getAttribLocation(o,"a_texcoord"),s=i.getUniformLocation(o,"u_resolution");i.viewport(0,0,x,T),i.uniform2f(s,x,T);var u=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,u),i.enableVertexAttribArray(c),i.vertexAttribPointer(c,2,i.FLOAT,!1,0,0),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW),{canvas:n,positionAttributeLocation:a,resolutionUniformLocation:s,webglContext:i}}(e)),setInterval(function(){x==e.clientWidth&&T==e.clientHeight||(x=e.clientWidth,T=e.clientHeight,"css3"==f?(g.style.width=x+"px",g.style.height=T+"px"):"canvas"==f?(u.style.width=x+"px",u.style.height=T+"px",u.width=x,u.height=T):"webgl"==f&&(y.canvas.style.width=x+"px",y.canvas.style.height=T+"px",y.canvas.width=x,y.canvas.height=T,y.webglContext.viewport(0,0,x,T),y.webglContext.uniform2f(y.resolutionUniformLocation,x,T)))},100),console.info("%cBulletScreenEngine%c now loaded.\n\n%cVersion: %s\nBuild Date: %s\n\n%cBulletScreenEngine is a high-performance JavaScript bullet-screen (danmaku) engine.\nHome: https://iamscottxu.github.io/BulletScreenEngine/","font-weight:bold; color:#0099FF;","","font-style:italic;",D.VERSION,D.BUILE_DATE,""),this.addBulletScreen=function(t){if((t=S(t,{})).text=S(t.text,"Empty"),t.boxColor=S(t.boxColor,null),t.speed=S(t.speed,.15),t.size=S(t.size,19),t.color=S(t.color,null),t.borderColor=S(t.borderColor,null),t.type=S(t.type,0),t.startTime=S(t.startTime,h.clock()),t.residenceTime=S(t.endTime,5e3),t.canDiscard=S(t.canDiscard,!0),t.type<=3){var e=l.getLength();l.forEach(function(e){if(t.startTime>e.startTime)return{add:{addToUp:!0,element:t},stop:!0}},!0),e==l.getLength()&&l.push(t,!1)}},this.play=function(){n||(t||(t=(new Date).getTime()),r&&(t+=h.clock()-r),n=!(i=null),requestAnimationFrame(w))},this.pause=function(){n&&(r=h.clock(),n=!1)},this.cleanBulletScreenList=function(){l.clean()},this.cleanBulletScreenListOnScreen=function(){v.clean(),"css3"===f?g.innerHTML="":"canvas"===f?u.getContext("2d").clearRect(0,0,x,T):"webgl"===f&&y.webglContext.clear(webglContext.COLOR_BUFFER_BIT)},this.stop=function(){n&&this.pause(),this.cleanBulletScreenList(),this.cleanBulletScreenListOnScreen(),r=0,t=null},this.hide=function(){o=!0,"css3"===f?g.style.visibility="hidden":"canvas"===f?u.style.visibility="hidden":"webgl"===f&&(y.canvas.style.visibility="hidden")},this.show=function(){o=!1,"css3"===f?g.style.visibility="visible":"canvas"===f?u.style.visibility="visible":"webgl"===f&&(y.canvas.style.visibility="visible")},this.setOpacity=function(e){s=e,"css3"===f?g.style.opacity=e:"canvas"===f?u.style.opacity=e:"webgl"===f&&(y.canvas.style.opacity=e)},this.getOpacity=function(){return s},this.getVisibility=function(){return!o},this.getRenderMode=function(){return f},this.getPlayState=function(){return n},this.getDebugInfo=function(){return{time:n?h.clock():r,bulletScreensOnScreenCount:v.getLength(),bulletScreensCount:l.getLength(),delay:p,delayBulletScreensCount:a,fps:n?parseInt(1e3*c):0}},this.getVersion=function(){return{version:D.VERSION,buildDate:D.BUILE_DATE}}}},{"./event":4,"./linkedList":5,"./version":6}],2:[function(e,t,n){"use strict";var i=e("./BulletScreenEngine");window.BulletScreenEngine=i.BulletScreenEngine},{"./BulletScreenEngine":1}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BulletScreenEngine=void 0;var C=e("./linkedList"),B=e("./event"),D=e("./version");n.BulletScreenEngine=function(e,h){var t,n,i,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"canvas",r=0,l=new C.LinkedList,v=new C.LinkedList,a=0,p=0,c=.06,o=!1,s=0;(h=S(h,{})).verticalInterval=S(h.verticalInterval,8),h.playSpeed=S(h.playSpeed,1),h.clock=S(h.clock,function(e){return(new Date).getTime()-t}),h.shadowBlur=S(h.shadowBlur,2),h.scaling=S(h.scaling,1),h.timeOutDiscard=S(h.timeOutDiscard,!0),h.fontWeight=S(h.fontWeight,600),h.fontFamily=S(h.fontFamily,"sans-serif"),this.option=h;var u,g,y,d=new B.Event;d.add("click"),d.add("contextmenu"),this.bind=d.bind,this.unbind=d.unbind;var m,b,x=e.clientWidth,T=e.clientHeight;function S(e,t){return void 0===e?t:"number"==typeof e&&isNaN(e)?t:null===e?t:e}function w(){var o,e=(new Date).getTime();null!=i&&(c=1/(e-i)),i=e,function(){0==v.getLength()&&(p=0);var e=.02<c?Math.ceil(1/c):1;do{var t=l.pop(!1,!1);if(null==t)return;var n=h.clock();if(t.startTime>n)return;!h.timeOutDiscard||!t.canDiscard||t.startTime>n-1/c*1.5?_(n,t):a++,l.pop(!0,!1),e--}while(0==v.getLength()||0<e)}(),v.forEach(function(e){var t=h.clock();switch(e.bulletScreen.type){case 0:if(!(e.x>-e.width))return"css3"===f&&g.removeChild(e.element),{remove:!0};e.x-=e.bulletScreen.speed*h.playSpeed/c;break;case 1:if(!(e.x<x))return"css3"===f&&g.removeChild(e.element),{remove:!0};e.x+=e.bulletScreen.speed*h.playSpeed/c;break;case 2:case 3:if(e.endTime<t)return"css3"===f&&g.removeChild(e.element),{remove:!0}}},!0),"css3"===f?v.forEach(function(e){e.element.style.transform="translate("+(e.x-4)+"px,"+(e.actualY-4)+"px)"},!0):"canvas"===f?function(){var e=document.createElement("canvas");e.width=u.width,e.height=u.height;var t=e.getContext("2d");v.forEach(function(e){t.drawImage(e.hideCanvas,e.x-4,e.actualY-4)},!0);var n=u.getContext("2d");n.clearRect(0,0,x,T),n.drawImage(e,0,0)}():"webgl"===f&&((o=y.webglContext).clear(o.COLOR_BUFFER_BIT),v.forEach(function(e){var t=e.x-4,n=t+e.width+8,i=e.actualY-4,r=i+e.height+8;o.bindTexture(o.TEXTURE_2D,e.texture2D);var l=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,l),o.enableVertexAttribArray(y.positionAttributeLocation),o.vertexAttribPointer(y.positionAttributeLocation,2,o.FLOAT,!1,0,0),o.bufferData(o.ARRAY_BUFFER,new Float32Array([t,i,n,i,t,r,t,r,n,i,n,r]),o.STATIC_DRAW),o.drawArrays(o.TRIANGLES,0,6)},!0)),n&&requestAnimationFrame(w)}function E(e){var t=document.createElement("canvas");t.width=e.width+8,t.height=e.height+8;var n=t.getContext("2d");return n.textBaseline="top",n.shadowColor="black",n.font=h.fontWeight+" "+e.size.toString()+"px "+h.fontFamily,null!=e.bulletScreen.color&&(n.shadowBlur=h.shadowBlur+.5,n.fillStyle=e.bulletScreen.color,n.fillText(e.bulletScreen.text,4,4)),null!=e.bulletScreen.borderColor&&(n.shadowBlur=0,n.lineWidth=.5,n.strokeStyle=e.bulletScreen.borderColor,n.strokeText(e.bulletScreen.text,4,4)),null!=e.bulletScreen.boxColor&&(n.shadowBlur=0,n.lineWidth=2,n.strokeStyle=e.bulletScreen.boxColor,n.strokeRect(0,0,e.width+8,e.height+8)),t}function _(n,t){p=n-t.startTime;var e,i,r,l,o,a,c={};if(c.bulletScreen=t,c.startTime=n,c.size=c.bulletScreen.size*h.scaling,c.height=c.size,"css3"===f)c.element=(o=(l=c).bulletScreen,(a=document.createElement("div")).style.position="absolute",a.style.whiteSpace="nowrap",a.style.fontWeight=h.fontWeight,a.style.fontSize=l.size.toString()+"px",a.style.fontFamily=h.fontFamily,a.style.lineHeight=l.size.toString()+"px",a.style.textShadow="0 0 "+h.shadowBlur.toString()+"px black",null==o.color?a.style.color="rgba(0,0,0,0)":a.style.color=o.color,null!=o.borderColor&&(a.style.webkitTextStroke="0.5px",a.style.webkitTextStrokeColor=o.borderColor),null!=o.boxColor?(a.style.padding="3px",a.style.border="1px solid",a.style.borderColor=o.boxColor):a.style.padding="4px",a.innerText=o.text,a.bulletScreen=o,g.appendChild(a),a),c.width=c.element.clientWidth-8;else if("canvas"===f||"webgl"===f){var s=document.createElement("canvas").getContext("2d");s.font=h.fontWeight+" "+c.size.toString()+"px "+h.fontFamily,c.width=s.measureText(t.text).width,"canvas"===f?c.hideCanvas=E(c):c.texture2D=(e=E(c),i=y.webglContext,r=i.createTexture(),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),r)}switch(c.endTime=parseInt(n+(x+c.width)/(t.speed*h.playSpeed)),t.type){case 0:c.endTime=parseInt(n+(x+c.width)/(t.speed*h.playSpeed)),c.x=x,c.y=h.verticalInterval*h.scaling;break;case 1:c.endTime=parseInt(n+(x+c.width)/(t.speed*h.playSpeed)),c.x=-c.width,c.y=h.verticalInterval*h.scaling;break;case 2:c.endTime=c.startTime+t.residenceTime,c.x=parseInt((x-c.width)/2),c.y=h.verticalInterval*h.scaling;break;case 3:c.endTime=c.startTime+t.residenceTime,c.x=parseInt((x-c.width)/2),c.y=-h.verticalInterval*h.scaling-c.height}var u=v.getLength();if(1<t.type)v.forEach(function(e){if(e.bulletScreen.type==t.type)if(2==t.type){if(c.y+c.height<e.y)return{add:{addToUp:!0,element:L(c)},stop:!0};e.endTime<n?c.y=e.y:c.y=e.y+e.height+h.verticalInterval*h.scaling}else{if(c.y>e.y+e.height)return{add:{addToUp:!0,element:L(c)},stop:!0};e.endTime<n?c.y=e.y:c.y=e.y-c.height-h.verticalInterval*h.scaling}},!0);else{var d=c.width/(c.bulletScreen.speed*h.playSpeed);v.forEach(function(e){if(!(1<e.bulletScreen.type)){if(c.y+c.height<e.y)return{add:{addToUp:!0,element:L(c)},stop:!0};var t=e.width/(e.bulletScreen.speed*h.playSpeed);e.startTime+t>=n||e.endTime>=c.endTime-d?c.y=e.y+e.height+h.verticalInterval*h.scaling:c.y=e.y}},!0)}v.getLength()==u&&v.push(L(c),!1)}function L(e){var t=e.bulletScreen;return t.type<3?e.actualY=e.y%(T-e.height):3==t.type&&(e.actualY=T+e.y%T),e}function A(e){var t=document.createElement("canvas");return t.style.width=x+"px",t.style.height=T+"px",t.style.position="relative",t.width=x,t.height=T,R(t,!1),e.innerHTML="",e.appendChild(t),t}function R(e,t){function n(l){var o=null;return v.forEach(function(e){var t=e.x-4,n=t+e.width+8,i=e.actualY-4,r=i+e.height+8;if(l.x>=t&&l.x<=n&&l.y>=i&&l.y<=r)return o=e.bulletScreen,{stop:!0}},!1),o}function i(e){if(void 0===e.offsetX||null===e.offsetX){if(void 0===e.layerX||null===e.layerX){if(void 0===e.pageX||null===e.pageX){var t=document.documentElement,n=document.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}e.layerX=e.pageX-function(e){for(var t=0;t+=e.offsetLeft,null!=(e=e.offsetParent););return t}(e.target),e.layerY=e.pageY-function(e){for(var t=0;t+=e.offsetTop,null!=(e=e.offsetParent););return t}(e.target)}e.offsetX=e.layerX-e.target.clientLeft,e.offsetY=e.layerY-e.target.clientTop}return{x:e.offsetX,y:e.offsetY}}e.onclick=t?(e.oncontextmenu=function(e){return e.target!=this&&d.trigger("contextmenu",{bulletScreen:e.target.bulletScreen}),!1},function(e){return e.target!=this&&d.trigger("click",{bulletScreen:e.target.bulletScreen}),!1}):(e.oncontextmenu=function(e){var t=n(i(e));return t&&d.trigger("contextmenu",{bulletScreen:t}),!1},function(e){var t=n(i(e));return t&&d.trigger("click",{bulletScreen:t}),!1})}"css3"==f?(m=e,(b=document.createElement("div")).style.width=x+"px",b.style.height=T+"px",b.style.overflow="hidden",b.style.position="relative",b.style.padding="0",b.style.margin="0",b.style.webkitUserSelect="none",R(b,!0),m.innerHTML="",m.appendChild(b),g=b):"canvas"==f?u=A(e):"webgl"==f&&(y=function(e){var t=function(e,t,n){var i=e.createShader(t);e.shaderSource(i,n),e.compileShader(i);var r=e.getShaderParameter(i,e.COMPILE_STATUS);if(r)return i;e.deleteShader(i)},n=A(e),i=n.getContext("webgl");i.enable(i.BLEND),i.clearColor(0,0,0,0),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA);var r=t(i,i.VERTEX_SHADER,"attribute vec2 a_position;attribute vec2 a_texcoord;uniform vec2 u_resolution;varying vec2 v_texcoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texcoord = a_texcoord;}"),l=t(i,i.FRAGMENT_SHADER,"precision mediump float;varying vec2 v_texcoord;uniform sampler2D u_texture;void main() {gl_FragColor = texture2D(u_texture, v_texcoord);}"),o=function(e,t,n){var i=e.createProgram();if(e.attachShader(i,t),e.attachShader(i,n),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS))return i;e.deleteProgram(i)}(i,r,l);i.useProgram(o);var a=i.getAttribLocation(o,"a_position"),c=i.getAttribLocation(o,"a_texcoord"),s=i.getUniformLocation(o,"u_resolution");i.viewport(0,0,x,T),i.uniform2f(s,x,T);var u=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,u),i.enableVertexAttribArray(c),i.vertexAttribPointer(c,2,i.FLOAT,!1,0,0),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW),{canvas:n,positionAttributeLocation:a,resolutionUniformLocation:s,webglContext:i}}(e)),setInterval(function(){x==e.clientWidth&&T==e.clientHeight||(x=e.clientWidth,T=e.clientHeight,"css3"==f?(g.style.width=x+"px",g.style.height=T+"px"):"canvas"==f?(u.style.width=x+"px",u.style.height=T+"px",u.width=x,u.height=T):"webgl"==f&&(y.canvas.style.width=x+"px",y.canvas.style.height=T+"px",y.canvas.width=x,y.canvas.height=T,y.webglContext.viewport(0,0,x,T),y.webglContext.uniform2f(y.resolutionUniformLocation,x,T)))},100),console.info("%cBulletScreenEngine%c now loaded.\n\n%cVersion: %s\nBuild Date: %s\n\n%cBulletScreenEngine is a high-performance JavaScript bullet-screen (danmaku) engine.\nHome: https://iamscottxu.github.io/BulletScreenEngine/","font-weight:bold; color:#0099FF;","","font-style:italic;",D.VERSION,D.BUILE_DATE,""),this.addBulletScreen=function(t){if((t=S(t,{})).text=S(t.text,"Empty"),t.boxColor=S(t.boxColor,null),t.speed=S(t.speed,.15),t.size=S(t.size,19),t.color=S(t.color,null),t.borderColor=S(t.borderColor,null),t.type=S(t.type,0),t.startTime=S(t.startTime,h.clock()),t.residenceTime=S(t.endTime,5e3),t.canDiscard=S(t.canDiscard,!0),t.type<=3){var e=l.getLength();l.forEach(function(e){if(t.startTime>e.startTime)return{add:{addToUp:!0,element:t},stop:!0}},!0),e==l.getLength()&&l.push(t,!1)}},this.play=function(){n||(t||(t=(new Date).getTime()),r&&(t+=h.clock()-r),n=!(i=null),requestAnimationFrame(w))},this.pause=function(){n&&(r=h.clock(),n=!1)},this.cleanBulletScreenList=function(){l.clean()},this.cleanBulletScreenListOnScreen=function(){v.clean(),"css3"===f?g.innerHTML="":"canvas"===f?u.getContext("2d").clearRect(0,0,x,T):"webgl"===f&&y.webglContext.clear(webglContext.COLOR_BUFFER_BIT)},this.stop=function(){n&&this.pause(),this.cleanBulletScreenList(),this.cleanBulletScreenListOnScreen(),r=0,t=null},this.hide=function(){o=!0,"css3"===f?g.style.visibility="hidden":"canvas"===f?u.style.visibility="hidden":"webgl"===f&&(y.canvas.style.visibility="hidden")},this.show=function(){o=!1,"css3"===f?g.style.visibility="visible":"canvas"===f?u.style.visibility="visible":"webgl"===f&&(y.canvas.style.visibility="visible")},this.setOpacity=function(e){s=e,"css3"===f?g.style.opacity=e:"canvas"===f?u.style.opacity=e:"webgl"===f&&(y.canvas.style.opacity=e)},this.getOpacity=function(){return s},this.getVisibility=function(){return!o},this.getRenderMode=function(){return f},this.getPlayState=function(){return n},this.getDebugInfo=function(){return{time:n?h.clock():r,bulletScreensOnScreenCount:v.getLength(),bulletScreensCount:l.getLength(),delay:p,delayBulletScreensCount:a,fps:n?parseInt(1e3*c):0}},this.getVersion=function(){return{version:D.VERSION,buildDate:D.BUILE_DATE}}}},{"./event":4,"./linkedList":5,"./version":6}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Event=void 0;n.Event=function(){var c={};this.add=function(e){return void 0===c[e]&&(c[e]=[],!0)},this.remove=function(e){return void 0!==c[e]&&(delete c[e],!0)},this.bind=function(e,t){var n=c[e];if(void 0===n||"function"!=typeof t)return!1;for(var i in n)if(n[i]===t)return!1;return n.push(t)},this.unbind=function(e,t){var n=c[e];if(void 0===n)return!1;if("function"!=typeof t)return c[e]=[],!0;for(var i in n)if(n[i]===t)return n.splice(t,1),n.length},this.trigger=function(e,t){var n=c[e];if(void 0===n)return!1;var i=!0,r=!1,l=void 0;try{for(var o,a=n[Symbol.iterator]();!(i=(o=a.next()).done);i=!0)if(!(0,o.value)(t))return!0}catch(e){r=!0,l=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw l}}return!0}}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LinkedList=void 0;n.LinkedList=function(){var l=function(e){this.element=e,this.next=null,this.previous=null},o=new l(null),a=new l(null),c=0;(o.next=a).previous=o,this.getLength=function(e){return c},this.push=function(e,t){var n=new l(e);t?(n.next=o.next,(n.previous=o).next=o.next.previous=n):(n.previous=a.previous,(n.next=a).previous=a.previous.next=n),c++},this.pop=function(e,t){var n;return t?(n=o.next,o.next!=a&&e&&((n.next.previous=o).next=n.next)):(n=a.previous,a.previous!=o&&e&&((n.previous.next=a).previous=n.previous)),e&&c--,n.element},this.clean=function(){o=new l(null),a=new l(null),(o.next=a).previous=o,c=0},this.forEach=function(e,t){for(var n=t?o:a;t?(n=n.next)!=a:(n=n.previous)!=o;){var i=e(n.element);if(i){if(i.add){var r=new l(i.add.element);i.add.addToUp?(r.previous=n.previous,(r.next=n).previous.next=r,n.previous=r):(r.previous=n,r.next=n.next,n.next.previous=r,n.next=r),c++}if(i.remove&&(n.previous.next=n.next,n.next.previous=n.previous,c--),i.stop)return}}}}},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BUILE_DATE=n.VERSION=void 0;n.VERSION="1.3";n.BUILE_DATE="Mon, 07 Jan 2019 15:04:25 GMT"},{}]},{},[2,3]);