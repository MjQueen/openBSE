<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>弹幕引擎Demo</title>
    <script src="lib/linkedList.js"></script>
    <script src="bulletCommentEngine.js"></script>
    <script>
        let bulletComment;
        window.onload = function () {
            bulletCommentEngine = new BulletCommentEngine(document.getElementById('bulletCommentsDiv'), { timeOutDiscard: true }, 'canvas');
            loadData(bulletCommentEngine);
            setInterval(showDebugInfo, 500);
        }
        let loadData = function (bulletCommentEngine) {
            let _startTime = 5000;
            for (let i = 0; i < 10000; i++) {
                if (Math.random() > 0.6)
                    bulletCommentEngine.addBulletComment({
                        text: "这是一个长长长长长长长长长长长长长长长长长长长长长长长长的测试(^_^)",
                        speed: 0.15 + Math.random() / 90,
                        size: 25,
                        color: 'white',
                        borderCorol: 'black',
                        type: (Math.random() > 0.4) ? 0 : 2,
                        startTime: _startTime
                    });
                else
                    bulletCommentEngine.addBulletComment({
                        text: "橘里橘气",
                        speed: 0.1 + Math.random() / 90,
                        size: 24,
                        color: '#FFCC66',
                        borderCorol: '#FF9933',
                        type: (Math.random() > 0.4) ? 0 : 2,
                        startTime: _startTime
                    });
                _startTime += parseInt(Math.random() * 500);
            }
        }
        let showDebugInfo = function () {
            let debugInfo = bulletCommentEngine.getDebugInfo();
            document.getElementById("time").innerText = debugInfo.time.toString();
            document.getElementById("delay").innerText = debugInfo.delay.toString();
            document.getElementById("fps").innerText = debugInfo.fps.toString();
            document.getElementById("bulletCommentsOnScreenCount").innerText = debugInfo.bulletCommentsOnScreenCount.toString();
            document.getElementById("bulletCommentsCount").innerText = debugInfo.bulletCommentsCount.toString();
            document.getElementById("delayBulletCommentsCount").innerText = debugInfo.delayBulletCommentsCount.toString();
        }
        function sendBulletComment() {
            let bulletCommentText = document.getElementById("BulletCommentText").value;
            document.getElementById("BulletCommentText").value = '';
            bulletCommentEngine.addBulletComment({
                text: bulletCommentText,
                speed: 0.18,
                size: 25,
                color: 'white',
                borderCorol: 'black',
                boxColor: 'white',
                canDiscard: false,
                startTime: 0
            });
        }
    </script>
</head>

<body>
    <div style="width:800px;height:450px;">
        <div style="width:100%;height:100%;background-color: black;"></div>
        <div id="bulletCommentsDiv" width="800" height="450" style="width:800px;height:450px;position:relative;left:0;top:-450px;z-index:1000;"></div>
    </div>
    <p><input type="text" style="width:500px;" id="BulletCommentText">&nbsp;<a href="#" onclick="sendBulletComment();">发送</a></p>
    <p>时间：<b id="time"></b> fps：<b id="fps"></b></p>
    <p>实时弹幕条数：<b id="bulletCommentsOnScreenCount"></b>&nbsp;剩余弹幕条数：<b id="bulletCommentsCount"></b></p>
    <p>延迟：<b id="delay"></b>ms 延迟丢弃丢弃弹幕数：<b id="delayBulletCommentsCount"></b></p>
    <a href="#" onclick="bulletCommentEngine.play();">开始</a>&nbsp;<a href="#" onclick="bulletCommentEngine.pause();">暂停</a>&nbsp;
    <a href="#" onclick="bulletCommentEngine.option.playSpeed = 1;">1倍速</a>&nbsp;<a href="#" onclick="bulletCommentEngine.option.playSpeed = 1.5;">1.5倍数</a>&nbsp;
    <a href="#" onclick="bulletCommentEngine.option.playSpeed = 2;">2倍速</a>&nbsp;<a href="#" onclick="bulletCommentEngine.option.playSpeed = 2.5;">2.5倍数</a>&nbsp;
</body>

</html>